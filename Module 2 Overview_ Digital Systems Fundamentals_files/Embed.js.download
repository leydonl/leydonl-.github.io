"use strict";(Panopto=Panopto||{}).PlayerJsFlowplayerAdapter=function(e,t){(t=t||{}).loadCallback=t.loadCallback||$.noop;var o=new playerjs.Receiver(["play","pause","timeupdate","seeked","ended","error"],["play","pause","mute","unmute","getDuration","getPaused","getMuted","getVolume","setVolume","getCurrentTime","setCurrentTime","getLoop","setLoop"]);o.on("play",(function(){e.ready?_.defer((function(){e.resume()})):t.loadCallback()})),o.on("pause",(function(){_.defer((function(){e.pause()}))})),o.on("mute",(function(){e.mute(!0)})),o.on("unmute",(function(){e.mute(!1)})),o.on("getDuration",(function(t){e.ready?t(e.video.duration):e.on("ready",(function(){t(e.video.duration)}))})),o.on("getPaused",(function(t){t(e.paused)})),o.on("getMuted",(function(t){t(e.muted)})),o.on("getVolume",(function(t){t(100*e.volumeLevel)})),o.on("setVolume",(function(t){e.volume(t/100)})),o.on("getCurrentTime",(function(t){t(e.video.time)})),o.on("setCurrentTime",(function(t){e.seek(t)}));var i=!1;return o.on("getLoop",(function(e){e(i)})),o.on("setLoop",(function(e){i=e})),e.on("ready",(function(){o.emit("play")})),e.on("pause",(function(){o.emit("pause")})),e.on("resume",(function(){o.emit("play")})),e.on("progress",(function(){o.eventListeners.timeupdate&&o.emit("timeupdate",{seconds:e.video.time,duration:e.video.duration})})),e.on("seek",(function(){o.emit("seeked")})),e.on("finish",(function(){o.emit("ended"),i&&e.resume()})),e.on("error",(function(){o.emit("error")})),o},(Panopto=Panopto||{}).Branding=Panopto.Branding||{};var renderBrandingStyleElement=$("<style />").appendTo("head");Panopto.Branding.createLogo=function(e,t,o){var i,n={svgUrl:null!==(i=t.svg)&&void 0!==i?i:Panopto.branding.svgLogo,pngUrl:t.png,width:t.svgWidth,height:t.svgHeight,mainLogoToolTip:Panopto.GlobalResources.Everything,customerLogoLink:Panopto.branding.siteLogoLink,cobrandLink:"https://www.panopto.com",cobrandString:Panopto.GlobalResources.PanoptoLogo_PoweredBy,listPageLink:PanoptoTS.StringHelpers.format("{0}/Pages/Sessions/List.aspx",Panopto.appRoot),linksEnabled:o},a=_.template($("#customerLogoTemplate").html())(n),r=_.template($("#panoptoLogoTemplate").html())(n);e.html(n.pngUrl&&-1===n.pngUrl.indexOf("_branding")?r:a)},Panopto.Branding.renderBrandingColors=function(e,t){var o,i,n,a=new PanoptoCore.Color(e),r=a.toHex(),s=a.getSafety().toHex(),l=a.getSafety().multiply(.9).toHex(),c=a.getSafety().multiply(.8).toHex(),u=[{selector:".accent-color",styleChanges:["color: {0}","border-color: {0}"]},{selector:".selected.accent-left-border",styleChanges:["border-left-color: {0}"]},{selector:".content-table table .selected .highlight-cell",styleChanges:["background-color: {0}"]},{selector:".embedded-plugin#batchUpload #sessionList .session.selected .session-check.accent-button",styleChanges:["background-color: {0}"]},{selector:".accent-background",styleChanges:["background-color: {0}"]},{selector:".selected.accented-tab",styleChanges:["border-left-color: {0}"]},{selector:".MuiSwitch-root .Mui-checked .MuiIconButton-label",styleChanges:["color: {0}"]},{selector:".MuiSwitch-root .Mui-checked + .MuiSwitch-track",styleChanges:["background-color: {0}"]},{selector:".MuiSwitch-colorSecondary.Mui-checked",styleChanges:["color: {0}"]}],d=[{selector:".selected.accent-left-border a",styleChanges:["border-left-color: {0}"]},{selector:".selected .accent-button",styleChanges:["border-color: {0}"]},{selector:".selected.accented-tab",styleChanges:["background-color: {0}"]},{selector:".safety-accent-border",styleChanges:["border-color: {0}"]},{selector:".safety-background",styleChanges:["background-color: {0}"]},{selector:".safety-text",styleChanges:["color: {0}"]},{selector:".safety-accent-highlighted.highlighted .event-text",styleChanges:["color: {0}"]},{selector:".safety-accent-highlighted.editing .event-text",styleChanges:["color: {0}"]},{selector:".safety-accent-highlighted.highlighted .event-time",styleChanges:["color: {0}"]},{selector:".safety-accent-highlighted.editing .event-time",styleChanges:["color: {0}"]},{selector:".event-tab-pane .match",styleChanges:["color: {0}"]},{selector:".safety-border",styleChanges:["border-color: {0}"]},{selector:".colored-scroll-button",styleChanges:["color: {0}"]},{selector:".selected.branded-border",styleChanges:["border-color: {0}"]}];t?u.push({selector:".safety-accent-border-ifcustom",styleChanges:["border-color: {0}"]}):d.push({selector:".safety-accent-border-ifcustom",styleChanges:["border-color: {0}"]});var p=function(e,t){return{selector:e,styleChanges:[PanoptoTS.StringHelpers.format("background-color: {0}",t),PanoptoTS.StringHelpers.format("border-color: {0}",t)]}};function h(e){_.each(e.styleChanges,(function(t){$.rule(e.selector+"{"+t+" !important}").appendTo(renderBrandingStyleElement)}))}function m(e,t){_.each(e,(function(e){h(e=function(e,t){return e.styleChanges=_.map(e.styleChanges,(function(e){return PanoptoTS.StringHelpers.format(e,t)})),e}(e,t))}))}o=p(".branded-button",s),i=p(".branded-button:hover:not(.disabled)",l),n=p(".branded-button:active:not(.disabled)",c),m(u,r),m(d,s),m([{selector:".embedded-plugin#batchUpload #sessionList .session.selected .session-check.accent-button:hover",styleChanges:["background-color: {0}"]},{selector:".embedded-plugin#batchUpload .create-upload:hover .create-upload-icon.image-accent-background",styleChanges:["background-color: {0}"]}],l),h(o),h(i),h(n);var g=function(e){if(!/^#[0-9a-f]{6}$/.test(e))return[];var t=e.substr(1,2),o=e.substr(3,2),i=e.substr(5,2);return[parseInt(t,16).toString(),parseInt(o,16).toString(),parseInt(i,16).toString()]}(r);[{selector:".MuiSwitch-colorSecondary.Mui-checked:hover",styleChanges:["background-color: {0}"],alpha:.04}].forEach((function(e){e.styleChanges=e.styleChanges.map((function(t){return PanoptoTS.StringHelpers.format(t,function(e){if(g.length&&!(e>1||e<0)){var t=e.toString();return"rgba(".concat(g[0],", ").concat(g[1],", ").concat(g[2],", ").concat(t,")")}}(e.alpha))})),h(e)}))},Panopto.Branding.brandElements=function(e){var t=new PanoptoCore.Color(e),o=t.toHex(),i=t.getSafety().toHex();Panopto.Branding.brandImageBackgrounds(".image-accent-background",".image-accent-background",o),Panopto.Branding.animateLoadingIndicator(i)},Panopto.Branding.animateLoadingIndicator=function(e){Panopto.Core.UI.Components.spinner($("#loadingMessage")),Panopto.Core.UI.Components.spinner($("#primaryBuffering")),Panopto.Core.UI.Components.spinner($("#secondaryBuffering")),Panopto.Core.UI.Components.spinner($(".logging-out-spinner")),Panopto.Core.UI.Components.spinner($(".logging-in-spinner")),Panopto.Core.UI.Components.spinner($("#modalSpinner")),Panopto.Core.UI.Components.spinner($(".event-tab-spinner")),Panopto.Branding.brandImageBackgrounds(".branded-animation",".spinner-background",e),$("#navBar .browse-spinner #path").css("fill",e)},Panopto.Branding.brandImageBackground=function(e,t){-1!==t.indexOf("_branding")&&e.css("background-image","url("+t+")")},Panopto.Branding.brandImageBackgroundRule=function(e,t){var o=-1!==t.indexOf("_branding");return o&&$.rule(e+"{background-image: url("+t+") !important}").appendTo(renderBrandingStyleElement),o},Panopto.Branding.brandImageBackgrounds=function(e,t,o){var i=_.filter(_.map($(e),(function(e){var t=$(e).css("background-image");return t&&(t=t.replace(/^url|[\(\")]/g,"")),t})),(function(e){return"none"!==e})),n=i.length,a=function(e){e||$.rule(t+"{background-color:"+o+" !important}").appendTo(renderBrandingStyleElement)};a(n),_.each(i,(function(e){var t=new Image,o=function(){n--,a(n)};t.onload=o,t.onerror=o,t.src=e}))},function(e){!function(e){var t=function(){function t(e,t,o,i,n){this.blocked=e,this.userId=t,this.ownerId=o,this.signupUrl=i,this.resources=n,this.eventNamespace="quota-playback-modal",this._onToggle=new PanoptoCore.TypedCallback}return Object.defineProperty(t.prototype,"onToggle",{get:function(){return this._onToggle},enumerable:!1,configurable:!0}),t.prototype.render=function(){var e=this;this.wrapper=$(t.template(this)),this.modal=this.wrapper.find(".quota-playback-modal"),this.wrapper.click((function(){e.blocked||e.hide()})),this.modal.click((function(e){e.stopPropagation()})),this.wrapper.hide(),$(window).resize((function(){e.modal.is(":visible")&&e.resize()}))},t.prototype.show=function(){var t,o=this;if(this.userId)t=this.userId===this.ownerId?new e.QuotaPlaybackModalDialogs.OwnerDialog(this.resources):new e.QuotaPlaybackModalDialogs.ViewerDialog(this.resources);else{var i=new e.QuotaPlaybackModalDialogs.AnonymousUserDialog(this.blocked,this.signupUrl,this.resources);i.onDismiss.add((function(){o.hide()})),t=i}t.render(),this.modal.contents().replaceWith(t.getElement()),this.wrapper.show(),this.resize(),$(window).on("resize."+this.eventNamespace,(function(){o.resize()})),this._onToggle.fire(!0)},t.prototype.hide=function(){this.wrapper.hide(),$(window).off("resize."+this.eventNamespace),this._onToggle.fire(!1)},t.prototype.fadeIn=function(){this.show(),this.wrapper.hide(),this.wrapper.fadeIn()},t.prototype.getElement=function(){return this.wrapper},t.prototype.resize=function(){this.modal.height(this.modal.find(".quota-dialog").height());var e=window.innerWidth/this.modal.find(".quota-dialog").width(),t=window.innerHeight/this.modal.height(),o=Math.min(e,t);this.modal.css({transform:"scale("+Math.min(1,o)+") translate(-50%, -50%)"})},t.template=_.template("\n            <div class='quota-playback-modal-wrapper'>\n                <div class='quota-playback-modal'>\n                </div>\n            </div>\n        "),t}();e.QuotaPlaybackModal=t}(e.Controls||(e.Controls={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){var t=function(){function t(e,o,i,n,a,r,s){this.cookieService=e,this.container=o,this.resources=i,this.deliveryId=n,this.ownerId=a,this.userId=r,this.signupUrl=s,this.secondsListened=0,this._onToggle=new PanoptoCore.TypedCallback,this.quotaBlockedCookieName=t.quotaBlockedCookiePrefix+this.deliveryId}return Object.defineProperty(t.prototype,"onToggle",{get:function(){return this._onToggle},enumerable:!1,configurable:!0}),t.prototype.initialize=function(o){var i=this;this.overQuota=o,this.overQuota||this.setBlockedCookie(!1),this.blocked=this.getBlockedCookie(),this.overQuota&&(this.availableSeconds=this.blocked?0:t.playbackTeaseDuration),this.modal=new e.QuotaPlaybackModal(this.blocked,this.userId,this.ownerId,this.signupUrl,this.resources),this.modal.onToggle.add((function(e){i._onToggle.fire(e)})),this.modal.render(),this.container.append(this.modal.getElement()),window.setTimeout((function(){window.location.reload()}),864e5),this.blocked&&this.modal.show()},t.prototype.update=function(e){if(!this.userId&&!this.overQuota&&0===this.secondsListened&&e){var o=parseInt(this.cookieService.getCookie(t.signupViewedCookieName),10)||0;o%t.signupShowInterval==t.signupShowInterval-1&&this.modal.show(),this.cookieService.setCookie(t.signupViewedCookieName,o+1)}this.secondsListened+=e,this.blocked=void 0!==this.availableSeconds&&this.secondsListened>=this.availableSeconds,this.blocked&&(this.modal.blocked=this.blocked,this.modal.show(),this.setBlockedCookie(!0))},t.prototype.fadeInModalForAnonymous=function(){this.userId||this.modal.fadeIn()},t.prototype.setBlockedCookie=function(e){e?this.cookieService.setCookie(this.quotaBlockedCookieName,e):this.cookieService.deleteCookie(this.quotaBlockedCookieName)},t.prototype.getBlockedCookie=function(){return"true"===this.cookieService.getCookie(this.quotaBlockedCookieName)},t.playbackTeaseDuration=30,t.quotaBlockedCookiePrefix="quotaBlocked",t.signupViewedCookieName="signupViewed",t.signupShowInterval=5,t}();e.QuotaPlaybackTracker=t}(e.Controls||(e.Controls={}))}(PanoptoTS||(PanoptoTS={}));var __awaiter=this&&this.__awaiter||function(e,t,o,i){return new(o||(o=Promise))((function(n,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))},__generator=this&&this.__generator||function(e,t){var o,i,n,a,r={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(n=r.trys,(n=n.length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){r.label=a[1];break}if(6===a[0]&&r.label<n[1]){r.label=n[1],n=a;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(a);break}n[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e],i=0}finally{o=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},__spreadArray=this&&this.__spreadArray||function(e,t,o){if(o||2===arguments.length)for(var i,n=0,a=t.length;n<a;n++)!i&&n in t||(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))};!function(e){!function(t){var o=Panopto.Core.StringHelpers,i=Panopto.Core.Key,n=PanoptoCore.Logging.Logger,a={trackPlayedColor:"rgba(255, 255, 255, 0.8)",trackPlayedActiveColor:"#FFF",trackBackgroundColor:"transparent",trackBorderColor:"rgba(255, 255, 255, 0.3)",labelFontColor:"#FFF",labelBackgroundColor:"rgba(0, 0, 0, 0.8)"},r=function(){function r(t,i,n){var a,s,l,c=this;this.deliveryService=i,this.webcastVersionService=n,this.iPhoneReturnFromFullscreenPlaying=!1,this.downloadEnabled=!1,this.positionListeners=[],this.processingPingIntervalMsec=Panopto.features.embedProcessingStatusIntervalMsec,this.checkCopyrightNoticeRequirement=$.Deferred(),this.checkBlockingLTIQuiz=$.Deferred(),this.invocationRequested=!1,this.audioDescriptionsActivated=!1,this.eventOverlayShown=!1,this.menuOpen=!1,this.nativeFullscreen=!1,this._selectedCaptionSetting="selectedCaptionSetting",this._selectedAudioDescriptionSetting="selectedAudioDescriptionSetting",this.wasRenderCalled=!1,this.quizWarnHasShown=!1,this.handleEmbedApiCommand=function(e){return __awaiter(c,void 0,void 0,(function(){var t,o,i,n,a,r=this;return __generator(this,(function(s){switch(s.label){case 0:switch(e.msg){case PanoptoViewer.EmbedApiMessagesToFrame.Play:return[3,1];case PanoptoViewer.EmbedApiMessagesToFrame.Pause:return[3,3];case PanoptoViewer.EmbedApiMessagesToFrame.Mute:return[3,4];case PanoptoViewer.EmbedApiMessagesToFrame.Unmute:return[3,5];case PanoptoViewer.EmbedApiMessagesToFrame.Speed:return[3,7];case PanoptoViewer.EmbedApiMessagesToFrame.Seek:return[3,8];case PanoptoViewer.EmbedApiMessagesToFrame.Volume:return[3,9];case PanoptoViewer.EmbedApiMessagesToFrame.Load:return[3,10];case PanoptoViewer.EmbedApiMessagesToFrame.Stop:return[3,12];case PanoptoViewer.EmbedApiMessagesToFrame.CaptionsOn:return[3,13];case PanoptoViewer.EmbedApiMessagesToFrame.CaptionsOff:return[3,14]}return[3,15];case 1:return t=this.flowplayer?this.flowplayer.muted:null!==(a=null===(n=this.timelineState)||void 0===n?void 0:n.muted)&&void 0!==a&&a,[4,this.ensurePlayAllowed({muted:t})];case 2:return s.sent()&&this.resume(),[3,15];case 3:return this.pause(),[3,15];case 4:return this.mute(!0),[3,15];case 5:return[4,this.prepareForUnmute()];case 6:return s.sent(),this.mute(!1),[3,15];case 7:return this.requestSpeed(e.floatData),[3,15];case 8:return this.requestSeek(e.floatData),[3,15];case 9:return this.setVolume(e.floatData),[3,15];case 10:return[4,this.ensurePlayAllowed({muted:this.startMuted})];case 11:return s.sent()&&this.loadVideo(),[3,15];case 12:return this.stop(),[3,15];case 13:return this.nonNativeCaptionsAvailable&&(o=!1,isNaN(e.intData)||(i=this.initParams.AvailableLanguages[e.intData],this.timelineController&&i!==this.selectedCaption&&(this.getCaptions(this.deliveryId,this.inviteId,i).done((function(){return r.toggleCaptions(!0)})),o=!0),this.selectedCaption=i),o||this.toggleCaptions(!0)),[3,15];case 14:return this.nonNativeCaptionsAvailable&&this.toggleCaptions(!1),[3,15];case 15:return[2]}}))}))},this.handleFullViewerButtonActivated=function(){if(c.fullViewerLinkEnabled){c.isLiveBroadcast?(c.flowplayer&&c.flowplayer.mute(!0,!0),c.timelineController&&c.timelineController.muted(!0)):(c.flowplayer&&c.flowplayer.pause(),c.timelineController&&c.timelineController.pause());var e=0;c.flowplayer&&(e=c.flowplayer.video.time),c.timelineController&&(e=c.timelineState.timelinePosition||0);var t=c.playlistId?"&pid=".concat(c.playlistId):"";window.open("".concat(c.initParams.ViewerLink).concat(t,"&start=").concat(e))}},null===(a=Panopto.MicrosoftTeamsUtils)||void 0===a||a.closePopoverLoginPageInTeamsApp(),PanoptoCore.Helpers.applyFullpage(),PanoptoViewer.configure({hlsJsConfig:Panopto.viewer.hlsJsConfig,flowplayerKey:t.PlayerKey,serverAuthoritativeLeadingEvents:Panopto.features.serverAuthoritativeLeadingEvents,enableTextTrackCaptionSource:Panopto.viewer.enableTextTrackCaptionSource}),this.viewerLogging=new PanoptoViewer.ViewerLogging(Panopto.globalServicesFQDN),this.initParams=t,this.sessionListUrl="".concat(Panopto.uriScheme,"://").concat(Panopto.webServerFQDN).concat(Panopto.appRoot,"/Pages/Sessions/List.aspx"),this.defaultThumbnailUrl="".concat(Panopto.cacheRoot,"/Images/no_thumbnail.svg"),this.loginUrl=String.format(this.initParams.LoginUrl,encodeURIComponent(window.location.href));var u=o.parseQueryString(location.search,!0,!0);this.interactivity="none"===u.interactivity||"false"===u.interactivity?"none":"search"===u.interactivity?"search":"all",this.hideOverlay=o.parseBoolean(u.hideoverlay);var d=o.parseBoolean(u.remoteembed),p=u.remotehost,h=u.embedapiid,m="MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,g=!!PanoptoCore.Browser.$_mobile||m,y=!!(PanoptoCore.Browser.$_ipad||PanoptoCore.Browser.$_iphone||PanoptoCore.Browser.$_ipod)||m,v=o.parseBoolean(u.iosapp),f=o.parseBoolean(u.androidapp),P=o.parseBoolean(u.videopreview),b=o.parseBoolean(u.panoptomobile),C=v||f||b,w=!(C||y&&!PanoptoCore.Browser.$_safari),S=u.query,k=this.initParams.IsLiveBroadcast;this.isLiveBroadcast=k;var T=this.ensureMobileCompatibleManifest(this.initParams.VideoUrl),D=o.parseBoolean(u.advance),A=o.parseBoolean(u.autoplay)&&Panopto.features.autoPlayEnabled||D,I=!("showtitle"in u)||o.parseBoolean(u.showtitle),E=u.showbrand?o.parseBoolean(u.showbrand):Panopto.features.brandEmbedViewer;this.scormEnabled=u.isscorm;var V,R=!(!(null===(s=Panopto.teamsApp)||void 0===s?void 0:s.isFromTeams)||!PanoptoCore.Browser.isMobileOrTablet),L=(_.isUndefined(u.offerviewer)||o.parseBoolean(u.offerviewer)||Panopto.useFreeTrialTerminology)&&!o.parseBoolean(u.internal)&&(!g||PanoptoCore.Browser.inIframe()&&!PanoptoCore.Helpers.fullscreenEnabled)&&!this.scormEnabled||R,B=u.start?parseFloat(u.start):void 0;u.outcome_did&&(V={outcomeId:u.outcome_did,oauthConsumerKey:u.oauth_consumer_key,outcomeServiceUrl:u.lis_outcome_service_url});var M,U=(_.isUndefined(u.autohide)||o.parseBoolean(u.autohide))&&!this.initParams.IsAudioOnly;M=_.isUndefined(u.flash)?!_.isUndefined(u.htmlfirst)&&!o.parseBoolean(u.htmlfirst):o.parseBoolean(u.flash);var F=(PanoptoCore.Helpers.fullscreenEnabled||y)&&!this.initParams.IsAudioOnly&&!C&&!this.hideOverlay,q=!!this.initParams.CaptionUrl&&this.initParams.CaptionUrl.length>0,O=PanoptoCore.CookieHelpers.getUserCookieField(Panopto.user.userKey,r.captionsCookieKey),H=_.isUndefined(u.captions)?void 0:o.parseBoolean(u.captions),x="boolean"==typeof O?O:"boolean"==typeof H?H:Panopto.captionSettings.enabledDefault,N=q&&x,z=this.initParams.VRType>PanoptoViewer.MediaVRType.None,G=this.initParams.EnableEmbedMultistream&&!z,Q=!k||G,W=Q?Panopto.viewer.seekAndVspBehavior:"no-seeking",j=PanoptoCore.CookieHelpers.getUserCookieField(Panopto.user.userKey,r.volumeCookieKey);"number"!=typeof j&&(j=r.maxVolume);var K=parseFloat(u.playspeed);K=Q&&-1!==r.playbackSpeeds.indexOf(K)?K:PanoptoViewer.PlaySpeed.Normal;var J=o.parseBoolean(u.starttourmuted),Y=r.flowplayerGlobal.support.volume&&(0===j||J),X=Panopto.Core.UI.Components.CopyrightNotice($("#copyrightNoticeContainer"),this.initParams.CopyrightNoticeText,this.initParams.CopyrightNoticeAutoDismissDuration,Panopto.viewer.allowInsecureHTMLTagsInCopyrightAndPolicyTexts);this.deliveryId=this.initParams.DeliveryId,this.sessionId=this.initParams.SessionId,this.playlistId=u.pid,this.playlistDeliveryId=u.id,this.inviteId=u.tid,this.videoUrl=T,this.isMobile=g,this.isIos=y,this.isIosApp=v,this.isAndroidApp=f,this.isReactNativeApp=b,this.isApp=C,this.downloadSupported=w,this.hasBackButton=this.isIosApp||this.isReactNativeApp,this.isVideoPreview=P,this.playlistAdvance=D,this.autoPlayRequested=A,this.startMuted=Y,this.startTourMutedQuery=J,this.showTitle=I,this.showBrand=E,this.showFullViewerLink=L,this.ltiOutcomeConfig=V,this.autoHideRequested=U,this.isLiveBroadcast=k,this.preferFlash=M,this.fullscreenEnabled=F,this.nonNativeCaptionsAvailable=q,this.vspSupported=Q,this.seekAndVspBehavior=W,this.isVR=z,this.remoteEmbed=d,this.remoteHost=p,this.embedApiId=h,this.isLTIContext=u.outcome_did,this.ltiCourseId=u.lticourseid,this.enableMultistream=G,this.initParams.TrustBrowserNativeHls&&PanoptoViewer.Players.PrimitivePlayerFactory.trustBrowserNativeHls(),this.defaultLayout=this.convertPodcastTypeToLayout(this.initParams.podcastLayout),this.startQueryParam=B,this.initialVolume=j,this.initialPlaySpeed=K,this.initialSearchTerm=S,this.player=$("#player"),this.eventOverlayElement=$("#eventOverlay"),this.copyrightNotice=X,this.shouldDisplayCaptionsInitially=x,this.captionsDisplayed=N,this.userSettingService=PanoptoCore.UserSettingsService.getInstance(),this.nonNativeCaptionsAvailable&&(this.selectedCaption=this.userSettingService.getSetting(this._selectedCaptionSetting),this.availableLanguagesFriendly=null===(l=this.initParams.AvailableLanguages)||void 0===l?void 0:l.map((function(e){return e?PanoptoCore.ContentLanguageFriendly[PanoptoCore.ContentLanguage[e]]:Panopto.GlobalResources.Admin_Captions_NoLanguage})),-1===this.initParams.AvailableLanguages.indexOf(this.selectedCaption)&&(this.selectedCaption=this.initParams.AvailableLanguages[0])),this.configureOrientationListener(),this.deliveryRefreshTimer=new PanoptoViewer.Controllers.DeliveryRefreshTimer(this.deliveryId,this.inviteId,!1,!0,!1,!1,i,n,(function(t){var o=6===c.initParams.podcastLayout&&!c.initParams.EnableEmbedMultistreamOverrideTileMode&&!c.initParams.IsLiveBroadcast,i=new RegExp(Panopto.viewer.mobileBroadcastUserAgentRegex,"i").test(navigator.userAgent),n=c.isLiveBroadcast&&i;return new e.Viewer.Data.Delivery(t,o,n)}),(function(e){PanoptoViewer.AudioDescriptionPlayer.initializeSpeechSynthesisVoices().then((function(){c.initializeAudioDescriptions(),c.setDelivery(e);var t=!!c.isLTIContext&&!!c.quizzes.length;c.fullViewerLinkEnabled=L&&!t||R,c.checkForBlockingLTIQuiz(),c.render()}))}),(function(e){window.location.reload()}),(function(e){c.updateBroadcast(e)}),(function(){window.location.reload()}),(function(){c.wasRenderCalled||c.render()})),$((function(){c.deliveryRefreshTimer.start()}))}return Object.defineProperty(r.prototype,"autoHideEnabled",{get:function(){var e=this.initParams.IsAudioOnly&&$(window).height()<r.hoverCaptionsMinHeight&&this.captionsDisplayed;return this.autoHideRequested||e},enumerable:!1,configurable:!0}),r.prototype.convertPodcastTypeToLayout=function(e){return void 0!==PanoptoViewer.PlayerLayoutMode[e]?e:PanoptoViewer.PlayerLayoutMode.Normal},r.prototype.getCaptions=function(e,t,o){var i=this,a=$.Deferred();return this.deliveryService.getCaptions(e,t,o,(function(e){var t=e.map((function(e){return{text:e.Caption||"",time:e.Time,endTime:e.CaptionDuration&&Panopto.viewer.enableCaptionEndTimeInViewer?e.Time+e.CaptionDuration:void 0}})),r=PanoptoCore.ContentLanguage[o]||"[default language]";n.info("[Embed.ts] > Received ".concat(t.length," captions for ").concat(r)),i.timelineController&&t.length>0&&(a.resolve(t),i.timelineController.updateCaptions(t))}),(function(){n.error("[Embed.ts] > Failed to fetch captions"),a.reject()})),a.promise()},r.prototype.getAudioDescriptions=function(e,t,o){var i=this,a=$.Deferred();return this.deliveryService.getAudioDescriptions(e,t,o,(function(e){var t=e.map((function(e){return{text:e.Caption||"",time:e.Time,language:o}})),r=PanoptoCore.ContentLanguage[o]||"[default language]";n.info("[Embed.ts] > Received ".concat(t.length," audio descriptions for ").concat(r)),i.timelineController&&t.length?(a.resolve(t),i.timelineController.updateAudioDescriptions(t)):a.resolve([])}),(function(){n.error("[Embed.ts] > Failed to fetch audio descriptions"),a.reject()})),a.promise()},r.prototype.submitClientLog=function(){if(this.invocationId){var e={InvocationId:this.invocationId,Entries:__spreadArray(["SessionId: ".concat(this.delivery.serverModel.SessionId)],this.viewerLogging.retrieveLogs(),!0)};Panopto.Core.ServiceInterface.WCFRest.DataCS.submitViewerClientLog(e,(function(e){alert(Panopto.GlobalResources.ViewerPlus_LogsSent+e)}),(function(){alert(Panopto.GlobalResources.ViewerPlus_LogsError)}))}else n.warning("[Embed.ts] > Attempted to submit logs without an invocation ID")},r.prototype.setDelivery=function(e){var t,o=Panopto.Core.PlayResumption.calculateStartTime(e.lastViewingPosition,e.duration);if(this.delivery=e,this.downloadUrl=e.downloadUrl,this.downloadEnabled=!!this.downloadUrl&&this.downloadSupported,this.quizzes=_.filter(e.documents,(function(e){return e.isQuiz})),this.showFullViewerLink=this.showFullViewerLink&&!e.isPurgedEncode,this.timelineSeekHelper=new PanoptoViewer.TimelineSeekHelper(this.delivery.duration,this.seekAndVspBehavior,this.isLiveBroadcast),e.completionPercentage&&this.reportPercentCompleted(e.completionPercentage),this.scormEnabled)try{this.scormControl=new PanoptoViewer.Scorm.ScormControl(this.reportPercentCompleted.bind(this),this.delivery.duration),o=this.scormControl.lastPosition,this.updateScormProgress()}catch(e){PanoptoCore.Logging.Logger.error("Embed: error initializing ScormControl.",e)}void 0!==this.startQueryParam?this.startTime=null!==(t=this.timelineSeekHelper.getValidPosition(this.startQueryParam))&&void 0!==t?t:o:this.startTime=o},r.prototype.reportPercentCompleted=function(e){var t=Math.min((e-1)/100,1)*this.delivery.duration;this.timelineSeekHelper.updateFurthestWatchedPoint(t),"all-seeking"!==this.seekAndVspBehavior&&Panopto.viewer.enableSeekAndVspAfterPercentage>0&&Panopto.viewer.enableSeekAndVspAfterPercentage<e&&(this.seekAndVspBehavior="all-seeking",this.timelineSeekHelper.enableSeekAndVsp(),this.timelineSeekHelper.updateDuration(this.delivery.duration),this.enableSeekAndVspControls())},r.prototype.checkWebcastEnded=function(e,t){(this.delivery.broadcastInterrupted||this.delivery.broadcastEnded)&&e&&t?($("#broadcastStatus").text(this.delivery.broadcastInterrupted?Panopto.GlobalResources.Embed_BroadcastInterrupted:Panopto.GlobalResources.Embed_BroadcastEnded),$("#broadcastStatusWrapper").show()):$("#broadcastStatusWrapper").hide()},r.prototype.checkForApiStateChange=function(e){this.hasPlaybackRateChanged(e)&&(this.sendApiStateUpdate(PanoptoViewer.EmbedApiMessagesToParent.SpeedUpdate),this.sendReactNativeStateUpdate()),this.timelineState.paused!==e.paused&&(this.sendApiStateUpdate(PanoptoViewer.EmbedApiMessagesToParent.StateUpdate),this.sendReactNativeStateUpdate()),this.timelineState.timelinePosition===e.timelinePosition&&this.timelineState.muted===e.muted&&this.timelineState.volume===e.volume||(this.sendApiStateUpdate(void 0),this.sendReactNativeStateUpdate())},r.prototype.hasPlaybackRateChanged=function(e){return this.timelineState&&e.playbackRate!==this.timelineState.playbackRate},r.prototype.handleTimelineControllerStateChanged=function(e){var t,o,i,a,s,l,c=this;this.timelineSeekHelper.updateFurthestWatchedPoint(e.timelinePosition),this.timelineSeekHelper.updateDuration(e.duration);var u=this.hasPlaybackRateChanged(e);(null===(t=this.timelineState)||void 0===t?void 0:t.isLive)!==e.isLive&&PanoptoCore.Logging.Logger.verbose("EmbeddedViewer.handleTimelineControllerStateChanged:"+" isLive changed to ".concat(e.isLive));var d=this.timelineState;this.timelineState=e,this.checkForApiStateChange(d),u&&this.loggerSpeedChangeHandler&&this.loggerSpeedChangeHandler();var p=this.player.find(".mobile-transport-controls .play, .bottom-transport-controls .play"),h=Panopto.GlobalResources[e.paused?"Embed_Tooltip_Pause":"Embed_Tooltip_Play"];p.attr({title:h,"aria-label":h}),this.isLiveBroadcast&&this.checkWebcastEnded(e.paused||e.isBuffering,this.isPositionAtTheEnd(e.timelinePosition,e.duration));var m=this.timelineSeekHelper.getValidPlaySpeed(e.playbackRate,e.timelinePosition);void 0!==m&&m!==e.playbackRate&&this.setSpeed(m);h=Panopto.GlobalResources[e.muted?"Embed_Muted":"Embed_Unmuted"];if($("#muteButton").attr("title",h),this.player.toggleClass("is-muted",e.muted),d.volume!==e.volume||d.muted!==e.muted){var g=e.muted?0:100*e.volume;this.setVolumeCookie(g),this.isMobile||($("#volumeSlider").slider("value",g),$("#volumeLevel").css("width",g+"%"))}if(this.player.toggleClass("is-playing",!e.paused),d.paused&&!e.paused&&this.showControls(r.playDisplayDuration),e.isBuffering!==d.isBuffering){var y=e.isBuffering?"...":" completed";n.info("[Embed.ts] > Buffering".concat(y))}!d.paused&&e.paused&&this.showControls(!0),null===(o=this.timelineLayoutControls)||void 0===o||o.setProps({timelineState:e}),$("#title").toggleClass("has-layout-controls",e.availableSecondaryCount>0),null===(i=this.timelineSeekBar)||void 0===i||i.setProps({timelineState:e});var v=this.nonNativeCaptionsAvailable||PanoptoViewer.getEnableTextTrackCaptionSource()&&e.availableLanguages.length>0;null===(a=this.timelinePlaybackControls)||void 0===a||a.setProps({timelineState:e}),null===(s=this.timelineMobilePlaybackControls)||void 0===s||s.setProps({timelineState:e}),null===(l=this.timelineNavigationControls)||void 0===l||l.setProps({timelineState:e,showCaptionButton:v});var f=isFinite(e.timelinePosition)?Panopto.Core.TimeHelpers.formatDuration(e.timelinePosition,":",!1,0,!1):"";if($(".fp-elapsed").text(f),$(".fp-duration").text(Panopto.Core.TimeHelpers.formatDuration(e.duration,":",!1,0,!1)),$(".fp-remaining").text(Panopto.Core.TimeHelpers.formatDuration(e.duration-e.timelinePosition,":",!1,0,!1)),this.displaySpeed(e.playbackRate),e.activeSecondary instanceof PanoptoViewer.DocumentPlayer?$("#embed").toggleClass("show-interactivity",!1):$("#embed").toggleClass("show-interactivity","none"!==this.interactivity),this.isMobile&&e.isBuffering?$(".mobile-transport-controls .play").hide():$(".mobile-transport-controls .play").show(),Panopto.showQuizWarning&&this.delivery.hasQuiz&&!Panopto.user.userId&&!this.quizWarnHasShown&&e.timelinePosition>this.delivery.firstQuizOffset){this.quizWarnHasShown=!0,this.pause();var P=this.delivery.user.email||null,b=$("#proViewerSignupPopup");Panopto.SignupPromptPopup(b,{onClose:function(){b.hide(),c.resume()},position:e.timelinePosition,signupUrl:Panopto.freeTrialSignUpUrl,email:P,token:this.inviteId,sendGoogleAnalytics:function(e,t){return Panopto.GoogleAnalytics.sendProEvent(e,t)},resources:Panopto.GlobalResources})}this.positionListeners.forEach((function(t){return t(e.timelinePosition)})),(e.timelinePosition>=e.duration||e.isEnded)&&(this.playlistId?this.playlistOverlay.queueNextItem():this.delivery.nextDelivery?this.showNextDelivery():Panopto.useFreeTrialTerminology&&this.quotaPlaybackTracker.fadeInModalForAnonymous())},r.prototype.configureTimelineControllerControls=function(){var e=this;new PanoptoViewer.Controls.TimelineHotkeys((function(t){switch(e.showControls(r.controlDisplayDuration),t){case"togglePlayState":e.player.hasClass("is-ready")?e.togglePlayState():e.loadVideo();break;case"seekToBeginning":case"seekTo0Pct":e.requestSeekTo(0);break;case"seekToEnd":e.requestSeekTo(10);break;case"rewind":e.requestSeek(!1);break;case"forward":e.requestSeek(!0);break;case"seekTo10Pct":e.requestSeekTo(1);break;case"seekTo20Pct":e.requestSeekTo(2);break;case"seekTo30Pct":e.requestSeekTo(3);break;case"seekTo40Pct":e.requestSeekTo(4);break;case"seekTo50Pct":e.requestSeekTo(5);break;case"seekTo60Pct":e.requestSeekTo(6);break;case"seekTo70Pct":e.requestSeekTo(7);break;case"seekTo80Pct":e.requestSeekTo(8);break;case"seekTo90Pct":e.requestSeekTo(9);break;case"seekToPrevious":e.requestSeekTo();break;case"volumeUp":e.timelineController.volume(Math.min(e.timelineState.volume+.1,1));break;case"volumeDown":e.timelineController.volume(Math.max(e.timelineState.volume-.1,0));break;case"toggleMuted":e.timelineController.muted(!e.timelineState.muted);break;case"toggleFullscreen":e.toggleFullscreen();break;case"toggleCaption":e.nonNativeCaptionsAvailable&&e.activateCaptionsToggle();break;case"toggleAudioDescription":e.initParams.EnableAudioDescriptions&&e.initParams.AvailableAudioDescriptionLanguages.length&&e.activateAudioDescriptionsToggle();break;case"playbackRateDown":e.requestSpeed(!1);break;case"playbackRateUp":e.requestSpeed(!0);break;case"cancel":e.menuOpen?(e.hideMenus(),e.playlistOverlay&&e.playlistOverlay.hide(),e.showControls(r.controlDisplayDuration)):e.autoHideEnabled?e.showControls(!1,{ignorePlayState:!0}):Panopto.Core.ElementHelpers.blurActiveElement();break;case"sendLogs":e.submitClientLog()}}));$("#overlay").append("<div class='layout-container'></div>"),this.timelineLayoutControls=PanoptoReactComponents.bootstrapReactComponent(PanoptoViewer.Controls.TimelineLayoutControls)($(".layout-container"),{resources:Panopto.GlobalResources,timelineState:this.timelineState,onCycleSecondaryRequested:function(){e.timelineController.cycleSecondary(),e.showControls(r.controlDisplayDuration)},onLayoutRequested:function(t){e.timelineController.playerLayoutMode(t),e.showControls(r.controlDisplayDuration)}}),$("#hoverButtonContainer").prepend("<div class='seek-bar-container'></div>"),this.timelineSeekBar=PanoptoReactComponents.bootstrapReactComponent(PanoptoViewer.Controls.TimelineSeekBar)($(".seek-bar-container"),{timelineState:this.timelineState,broadcastEnded:this.delivery.broadcastEnded,disabled:!1,onPlayRequested:function(t){t?e.timelineController.pause():e.timelineController.resume()},onSeekRequested:function(t){e.requestSeek(t)},colors:a});var t=$("#hoverButtonContainer .playback-controls").empty();this.timelinePlaybackControls=PanoptoReactComponents.bootstrapReactComponent(PanoptoViewer.Controls.TimelinePlaybackControls)(t,{resources:Panopto.GlobalResources,timelineState:this.timelineState,useMobileLayout:this.isMobile,seekDisabled:!1,broadcastEnded:this.delivery.broadcastEnded,onPlayPauseButtonActivated:function(){return e.togglePlayState()},onRewindButtonActivated:function(){var t=e.timelineState.timelinePosition;e.requestSeek(Math.max(t-10,0))},onForwardButtonActivated:function(){var t=e.timelineState.timelinePosition,o=e.timelineState.duration;e.requestSeek(Math.min(t+10,o))},onMuteUnmuteButtonActivated:function(){return e.toggleMuted()},onVolumeChanged:function(t,o){var i,n;"number"==typeof o&&(null===(i=e.timelineController)||void 0===i||i.volume(o),0===o&&(null===(n=e.timelineController)||void 0===n||n.muted(!0))),t.preventDefault()},onGoLive:function(){e.requestSeek(e.timelineState.duration)},onShowControlsRequested:function(){},onResetHideControlsAfterUserActionRequest:function(){},onResetHideControlsAfterBlurRequested:function(){},colors:a});var o=$(".mobile-transport-controls").empty();this.timelineMobilePlaybackControls=PanoptoReactComponents.bootstrapReactComponent(PanoptoViewer.Controls.TimelineMobilePlaybackControls)(o,{resources:Panopto.GlobalResources,timelineState:this.timelineState,seekDisabled:!1,onPlayPauseButtonActivated:function(){return e.togglePlayState()},onRewindButtonActivated:function(){var t=e.timelineState.timelinePosition;e.requestSeek(Math.max(t-10,0))},onForwardButtonActivated:function(){var t=e.timelineState.timelinePosition,o=e.timelineState.duration;e.requestSeek(Math.min(t+10,o))}});var i=$("#secondaryControls").empty();this.timelineNavigationControls=PanoptoReactComponents.bootstrapReactComponent(PanoptoViewer.Controls.TimelineNavigationControls)(i,{resources:Panopto.GlobalResources,presetPlaybackRates:r.playbackSpeeds,timelineState:this.timelineState,showDownloadButton:this.downloadEnabled,viewerButtonMode:this.showFullViewerLink?this.fullViewerLinkEnabled?"visible":"disabled":"hidden",viewerButtonImage:Panopto.useFreeTrialTerminology?"logo":"arrow",viewerButtonTooltip:this.fullViewerLinkEnabled?Panopto.GlobalResources.Embed_Tooltip_FullViewer:Panopto.GlobalResources.Embed_Tooltip_FullViewerDisabled,showCaptionButton:this.nonNativeCaptionsAvailable,showAudioDescriptionButton:this.initParams.EnableAudioDescriptions&&!!this.initParams.AvailableAudioDescriptionLanguages.length,showFullscreenButton:PanoptoCore.Helpers.fullscreenEnabled&&this.fullscreenEnabled,isCurrentlyOnFullscreen:this.isFullscreen,vspDisabled:!1,onDownloadButtonActivated:function(){window.open(e.downloadUrl)},onViewerButtonActivated:this.handleFullViewerButtonActivated,onCaptionButtonActivated:function(){e.activateCaptionsToggle()},onAudioDescriptionButtonActivated:function(){e.activateAudioDescriptionsToggle()},onFullscreenRequested:function(){e.toggleFullscreen()},onPlaybackRateRequested:function(t){e.requestSpeed(t)},onShowControlsRequested:function(){},onResetHideControlsAfterBlurRequested:function(){}}),PanoptoCore.Helpers.handleFullscreenEvent((function(){var t;null===(t=e.timelineNavigationControls)||void 0===t||t.setProps({isCurrentlyOnFullscreen:e.isFullscreen})})),$("#embed").toggleClass("mobile",this.isMobile),this.player.toggleClass("mobile",this.isMobile),$(".touch-overlay").toggle(this.isMobile),$("#loadingSpinner").remove(),this.vspSupported||$(".bottom-transport-controls, .mobile-transport-controls, .seek-bar-container, .fp-duration").hide(),$("#overlay").css({"z-index":11})},r.prototype.embedControlSetupFlowplayer=function(){var e=this;this.embedApiParser=new PanoptoViewer.EmbedApiParser(this.handleEmbedApiCommand,this.remoteHost,this.embedApiId),this.flowplayer.splash&&this.embedApiParser.sendPostMessage(PanoptoViewer.EmbedApiMessagesToParent.IframeReady),this.flowplayer.on("pause resume stop playing finish seek volume progress speed error",(function(t){switch(t.type){case"pause":case"resume":case"stop":case"playing":case"finish":e.sendApiStateUpdate(PanoptoViewer.EmbedApiMessagesToParent.StateUpdate);break;case"speed":e.sendApiStateUpdate(PanoptoViewer.EmbedApiMessagesToParent.SpeedUpdate);break;case"error":e.embedApiParser.sendPostMessage(PanoptoViewer.EmbedApiMessagesToParent.Error,PanoptoViewer.ApiError.MediaPlayerError);break;default:e.sendApiStateUpdate(void 0)}}))},r.prototype.sendReactNativeStateUpdate=function(){var e,t=null;this.flowplayer?t={name:this.delivery.title,folderName:this.delivery.folder.name,thumbUrl:"".concat(Panopto.uriScheme,"://").concat(Panopto.webServerFQDN).concat(this.initParams.ThumbUrl).replace("usePng=False","usePng=True"),streamUrl:this.flowplayer.video.src,isPlaying:this.flowplayer.playing,position:this.flowplayer.video.time,playbackRate:this.flowplayer.currentSpeed,isMuted:this.flowplayer.muted}:this.timelineController&&(t={name:this.delivery.title,folderName:this.delivery.folder.name,thumbUrl:"".concat(Panopto.uriScheme,"://").concat(Panopto.webServerFQDN).concat(this.initParams.ThumbUrl).replace("usePng=False","usePng=True"),streamUrl:null===(e=this.timelineState.activePrimary)||void 0===e?void 0:e.streamUrl,isPlaying:!this.timelineState.paused,position:this.timelineState.timelinePosition,playbackRate:this.timelineState.playbackRate,isMuted:this.timelineState.muted}),t&&this.isReactNativeApp&&this.sendReactNativeMessage({action:"state",state:t})},r.prototype.sendApiStateUpdate=function(e){var t;this.embedApiParser&&(this.flowplayer?t={trigger:e,volume:this.flowplayer.volumeLevel,isMuted:0===this.flowplayer.volumeLevel,currentTime:this.flowplayer.video.time,speed:this.flowplayer.currentSpeed,duration:this.flowplayer.video.duration,isPaused:this.flowplayer.paused,isFinished:this.flowplayer.finished,captionLanguages:this.availableLanguagesFriendly,selectedLanguage:this.initParams.AvailableLanguages.indexOf(this.selectedCaption),areCaptionsEnabled:this.captionsDisplayed}:this.timelineController&&(t={trigger:e,volume:this.timelineState.volume,isMuted:this.timelineState.muted,currentTime:this.timelineState.timelinePosition,speed:this.timelineState.playbackRate,duration:this.timelineState.duration,isPaused:this.timelineState.paused,isFinished:this.timelineState.isEnded,captionLanguages:this.availableLanguagesFriendly,selectedLanguage:this.initParams.AvailableLanguages.indexOf(this.selectedCaption),areCaptionsEnabled:this.captionsDisplayed}),this.embedApiParser.sendPostMessage(PanoptoViewer.EmbedApiMessagesToParent.State,t))},r.prototype.sendReactNativeMessage=function(e){var t,o="back"===e.action?e.action:JSON.stringify(e);null===(t=window.ReactNativeWebView)||void 0===t||t.postMessage(o),console.log(o)},r.prototype.ensurePlayAllowed=function(e){var t=e.muted;return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(o){switch(o.label){case 0:return[4,this.checkAndReportAutoplay({muted:t})];case 1:return(e=o.sent()).canAutoplay||!e.canAutoplayMuted||this.flowplayer||this.mute(!0),[2,e.canAutoplayMuted]}}))}))},r.prototype.prepareForUnmute=function(){var e,t;return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(o){switch(o.label){case 0:return(this.flowplayer?this.flowplayer.paused:null!==(t=null===(e=this.timelineState)||void 0===e?void 0:e.paused)&&void 0!==t&&t)?[3,2]:[4,this.checkAndReportAutoplay({muted:!1})];case 1:o.sent().canAutoplay||this.pause(),o.label=2;case 2:return[2]}}))}))},r.prototype.checkAndReportAutoplay=function(e){var t=e.muted;return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(o){switch(o.label){case 0:return[4,PanoptoViewer.canAutoplay({muted:t,playsInline:!0})];case 1:return e=o.sent(),t||e.canAutoplay||!e.canAutoplayMuted?e.canAutoplayMuted||this.embedApiParser.sendPostMessage(PanoptoViewer.EmbedApiMessagesToParent.Error,PanoptoViewer.ApiError.PlayNotAllowed):this.embedApiParser.sendPostMessage(PanoptoViewer.EmbedApiMessagesToParent.Error,PanoptoViewer.ApiError.PlayWithSoundNotAllowed),[2,e]}}))}))},r.prototype.render=function(){var t=this;this.wasRenderCalled=!0,$("#title").toggle(this.showTitle),$("#player").toggleClass("title-shown",this.showTitle),$("#embed").toggleClass("show-interactivity","none"!==this.interactivity),this.player.toggleClass("audio-only",this.initParams.IsAudioOnly);var o=PanoptoCore.Helpers.StringHelpers.getUserKeyComponents(Panopto.user.userKey).provider;o&&Panopto.GoogleAnalytics.sendEvent({source:"viewer-embed",action:"embedded-view",label:o}),this.configureGlobalControls(),this.configureSplashScreen();var i=PanoptoViewer.canAutoplay({muted:this.startMuted,playsInline:!0,autoPlayRequested:this.autoPlayRequested});if(this.playlistId&&i.then((function(e){t.configurePlaylistOverlay(e.canAutoplay||e.canAutoplayMuted)})),this.initParams.ErrorCode)this.handleError();else if(this.delivery)if(this.isLiveBroadcast&&!this.delivery.activePrimary)this.showCallToAction({message:Panopto.GlobalResources.Embed_BroadcastNotStarted});else if(this.enableMultistream&&this.delivery.isEmbedViewable){if(Panopto.user.userId||(this.delivery.documents=this.delivery.documents.filter((function(e){return!e.isQuiz}))),this.timelineController=new PanoptoViewer.Controllers.TimelineController(this.delivery,Panopto.appRoot,Panopto.GlobalResources,(function(e){return t.handleTimelineControllerStateChanged(e)}),{resetToStartUponVoDEnd:!(this.remoteEmbed&&Panopto.enableEmbedApi||this.scormEnabled),defaultLayout:this.defaultLayout,focusService:Panopto.Core.UI.Accessibility,notifyInitialState:function(e){var o;t.timelineState=e,$("#title").toggleClass("has-layout-controls",(null===(o=t.timelineState)||void 0===o?void 0:o.availableSecondaryCount)>0)}}),this.initParams.AvailableLanguages.length>0&&this.getCaptions(this.deliveryId,this.inviteId,this.selectedCaption).done((function(){$("#captionsButton").show(),t.toggleCaptions(t.captionsDisplayed)})),this.initParams.EnableAudioDescriptions&&this.initParams.AvailableAudioDescriptionLanguages.length&&this.getAudioDescriptions(this.deliveryId,this.inviteId,this.selectedAudioDescriptionLanguage).done((function(){$("#audioDescriptionsButton").show(),t.toggleAudioDescriptions(t.audioDescriptionsActivated)})),this.configureTimelineControllerControls(),this.configurePanoptoControls(),this.generateCaptionStylesheet(),"none"!==this.interactivity&&this.configureEventsControl(),$("#broadcastStatusWrapper").insertAfter($("#audioOnlyIcon")),this.hideOverlay&&$("#hoverButtonContainer").css("visibility","hidden"),Panopto.user.userId&&(this.quizResultsController=new e.Viewer.QuizResultsController(this.quizzes,this.ltiOutcomeConfig),this.quizResultsController.onQuizCompleted(this.timelineController.dismissDocumentPlayer),this.quizResultsController.onQuizClosed(this.timelineController.dismissDocumentPlayer)),i.then((function(e){var o=e.canAutoplay||e.canAutoplayMuted;!e.canAutoplay&&e.canAutoplayMuted&&t.mute(!0),o&&t.playlistId&&t.playlistOverlay.visible()||t.showCopyrightNoticeIfRequired(),o&&!t.playlistId?t.loadVideo():($("#playIconContainer").toggle(!t.isMobile),$("#splashPlayIconContainer").toggle(t.isMobile))})),this.remoteEmbed&&Panopto.enableEmbedApi&&(this.embedApiParser=new PanoptoViewer.EmbedApiParser(this.handleEmbedApiCommand,this.remoteHost,this.embedApiId),this.embedApiParser.sendPostMessage(PanoptoViewer.EmbedApiMessagesToParent.IframeReady)),this.initializeQuotaTracker(),Panopto.useFreeTrialTerminology&&!this.isLandscape&&!Panopto.user.userId){var n=this.delivery.user.email||"null";Panopto.SignupBanner($("#proLoginBanner"),{imageLocation:Panopto.cacheRoot+"/Styles/Less/Application/Images/Header",signupUrl:Panopto.freeTrialSignUpUrl,isEmbed:!0,tokenId:this.inviteId,userEmail:n,resources:Panopto.GlobalResources})}}else{if("none"!==this.interactivity&&this.configureEventsControl(),this.initializePlayer(),this.fullscreenEnabled&&this.configureFullscreenControls(),this.remoteEmbed&&Panopto.enableEmbedApi&&this.embedControlSetupFlowplayer(),this.isReactNativeApp&&this.flowplayer.on("pause resume stop playing finish seek progress speed volume",(function(){t.sendReactNativeStateUpdate()})),this.initializeQuotaTrackerFlowplayer(),Panopto.useFreeTrialTerminology&&!this.isLandscape&&!Panopto.user.userId){n=this.delivery.user.email||"null";Panopto.SignupBanner($("#proLoginBanner"),{imageLocation:Panopto.cacheRoot+"/Styles/Less/Application/Images/Header",signupUrl:Panopto.freeTrialSignUpUrl,isEmbed:!0,tokenId:this.inviteId,userEmail:n,resources:Panopto.GlobalResources})}if("undefined"!=typeof playerjs)Panopto.PlayerJsFlowplayerAdapter(this.flowplayer,{loadCallback:function(){t.loadVideo()}}).ready();this.flowplayer.one("ready",(function(){if(t.videoElement=t.player.find("video.fp-engine")[0],t.hideOverlay?$(".fp-ui").hide():(t.configureFlowplayerControls(),t.configurePanoptoControls(),t.configureKeyHandler()),t.quizzes.length&&(Panopto.user.userId||Panopto.showQuizWarning)&&(t.configureProgressListener(!Panopto.user.userId),Panopto.user.userId&&t.configureQuizResultsController()),t.videoElement&&(t.videoElement.textTracks.length&&(t.isLiveBroadcast&&!t.nonNativeCaptionsAvailable?($("#captionsButton").toggle(!0),t.updateDividerVisibility(),t.captionsDisplayed=t.shouldDisplayCaptionsInitially,t.toggleNativeCaptions(!0)):t.toggleNativeCaptions(!1)),t.videoElement.textTracks.onaddtrack=function(e){t.isLiveBroadcast&&!t.nonNativeCaptionsAvailable?($("#captionsButton").toggle(!0),t.updateDividerVisibility(),t.toggleNativeCaptions(!0)):e.track.mode="disabled"},t.isLiveBroadcast)){var e=!1;t.flowplayer.on("pause",(function(){return e=!0})),t.flowplayer.on("pause",(function(){t.checkWebcastEnded(!0,t.isFlowPlayerAtTheEnd())}));var o=!1;t.flowplayer.on("finish",(function(){return o=!0})),document.addEventListener("visibilitychange",(function(){document.hidden||!e||o||(t.flowplayer.load(t.flowplayer.conf.clip),e=!1)}))}t.flowplayer.on("durationchange",(function(){t.timelineSeekHelper.updateDuration(t.flowplayer.video.duration)})),t.toggleCaptions(t.captionsDisplayed),t.startTime&&!t.flowplayer.engine.hls&&t.flowplayer.one("progress",(function(){t.seek(t.startTime)}))})),i.then((function(e){var o=e.canAutoplay||e.canAutoplayMuted;o&&t.playlistId&&t.playlistOverlay.visible()||t.showCopyrightNoticeIfRequired(),o&&!t.playlistId?t.loadVideo():($("#playIconContainer").toggle(!t.isMobile),$("#splashPlayIconContainer").toggle(t.isMobile))})),this.eventOverlay&&this.flowplayer.on("progress",(function(e,o,i){t.positionListeners.forEach((function(e){return e(i)}))})),this.playlistId?this.flowplayer.on("finish",(function(){return t.playlistOverlay.queueNextItem()})):this.delivery.nextDelivery&&this.flowplayer.on("finish",(function(){return t.showNextDelivery()})),this.flowplayer.on("progress",(function(e,o,i){t.timelineSeekHelper.updateFurthestWatchedPoint(i);var n=t.timelineSeekHelper.getValidPlaySpeed(t.flowplayer.currentSpeed,i);n!==t.flowplayer.currentSpeed&&t.setSpeed(n||PanoptoViewer.PlaySpeed.Normal)}))}else this.initParams.ErrorCode=PanoptoViewer.Data.ErrorCode.InvalidDelivery,this.handleError()},r.prototype.configureEventsControl=function(){var e=this;Panopto.Core.UI.Handlers.button($("#eventOverlayGutter .hit-target"),(function(t,o){e.toggleEventOverlay(!e.eventOverlayShown,{keyboardInitiated:"mousedown"!==o.type}),e.eventOverlayShown&&e.hideMenus(),e.showControls(!e.eventOverlayShown&&r.controlDisplayDuration,{ignorePlayState:!0})}),{pointerEvent:"mousedown touchstart"});var t={delivery:this.delivery,sessionId:this.sessionId,userId:Panopto.user.userId,inviteId:this.inviteId,loginUrl:Panopto.loginUrl,isLandscape:this.isLandscape,isMobile:this.isMobile,isMobileApp:this.isApp,isBroadcast:this.isLiveBroadcast,interactivity:this.interactivity,isDiscussionDownloadEnabled:!(this.isApp&&this.isIos),areSocialFeaturesEnabled:Panopto.features.areSocialFeaturesEnabled,areRatingsEnabled:Panopto.features.areRatingsEnabled,areNotesEnabled:Panopto.features.notesEnabled,areAudioDescriptionsEnabled:this.initParams.EnableAudioDescriptions,resources:Panopto.GlobalResources,initialSearchTerm:this.initialSearchTerm,availableLanguages:this.timelineController?this.initParams.AvailableLanguages:this.initParams.AvailableLanguages.slice(0,3),selectedLanguage:this.selectedCaption,availableAudioDescriptionLanguages:this.initParams.AvailableAudioDescriptionLanguages,selectedAudioDescriptionLanguage:this.selectedAudioDescriptionLanguage,showAllTocEntries:this.enableMultistream,onAddPositionListener:function(t){e.positionListeners.push(t),t(e.getPosition())},onRemovePositionListener:function(t){e.positionListeners=e.positionListeners.filter((function(e){return e!==t}))},onLanguageChanged:function(t){e.selectedCaption=t,e.userSettingService.setSetting(e._selectedCaptionSetting,e.selectedCaption),e.loadSubtitleTrack()},onAudioDescriptionLanguageChanged:function(t){e.selectedAudioDescriptionLanguage=t,e.userSettingService.setSetting(e._selectedAudioDescriptionSetting,e.selectedAudioDescriptionLanguage),e.loadAudioDescriptionTrack()},onSeekRequested:function(t){var o=e.timelineSeekHelper.getValidPosition(t);void 0!==o&&(e.toggleEventOverlay(!1),e.showControls(r.playDisplayDuration),e.flowplayer?e.flowplayer.splash?(e.startTime=o,e.flowplayer.conf.hlsjs.startPosition=o,e.loadVideo()):e.requestSeek(o,(function(){return e.flowplayer.resume()})):e.timelineController&&(e.player.hasClass("is-ready")?(e.requestSeek(o),e.timelineController.resume()):(e.startTime=o,e.loadVideo())))},onKeyDown:function(t){t.which===i.Esc&&e.isLandscape&&e.eventOverlayShown&&(e.toggleEventOverlay(!1),e.showControls(r.controlDisplayDuration),$("#eventOverlay").one("transitionend",(function(){$("#eventOverlayGutter .hit-target").focus()})))},showSendLogs:!!this.invocationId,onSubmitLogs:function(){return e.submitClientLog()}};this.eventOverlay=Panopto.EmbedEventOverlay($("#eventTabControl"),t)},r.prototype.toggleEventOverlay=function(e,t){var o=(void 0===t?{}:t).keyboardInitiated,i=void 0!==o&&o;"none"!==this.interactivity&&(this.eventOverlayShown=void 0!==e?e:!this.eventOverlayShown,$("#embed").toggleClass("event-overlay-shown",this.eventOverlayShown),this.eventOverlayShown?$("#eventOverlayGutter .hit-target").attr("aria-expanded","true"):$("#eventOverlayGutter .hit-target").removeAttr("aria-expanded"),this.timelineController&&(this.eventOverlayShown?this.timelineController.captionVisible(!1):this.timelineController.captionVisible(this.captionsDisplayed)),this.isLandscape&&this.handleEventOverlayModeChanged({isOverlay:this.eventOverlayShown,keyboardInitiated:i}))},r.prototype.handleEventOverlayModeChanged=function(e){var t=e.isOverlay,o=e.keyboardInitiated,i=void 0!==o&&o;t?Panopto.Core.UI.Accessibility.trapFocus(this.eventOverlayElement):Panopto.Core.UI.Accessibility.releaseFocus(this.eventOverlayElement),t&&$("#eventOverlay").one("transitionend",(function(){var e=$("#eventOverlay").find(":tabbable").first();e.focus(),i||(e.addClass("clicked"),e.one("blur",(function(){return e.removeClass("clicked")})))}))},r.prototype.initializePlayer=function(){var e={sources:[{type:this.initParams.MediaFileType===Panopto.Core.MediaFileType.hls?r.hlsMimeType:r.mp4MimeType,src:this.videoUrl}],live:this.isLiveBroadcast,vr:this.isVR};if(this.preferFlash){var t=_.extend({engine:"flash"},e.sources[0]);this.initParams.MediaFileType===Panopto.Core.MediaFileType.mp4&&this.initParams.RtmpServerUrl&&(e.rtmp=this.initParams.RtmpServerUrl,t={type:r.rtmpMimeType,src:this.initParams.RtmpRelativeUrl}),e.sources.unshift(t)}if(this.nonNativeCaptionsAvailable){var o=this.initParams.CaptionUrl.map((function(e){return{kind:"subtitles",label:Panopto.GlobalResources.ModalPopup_SessionTranscriptDisplayName,src:e}}));e.subtitles=o,this.generateCaptionStylesheet()}var i=-1!==window.location.search.indexOf("debuglog=true"),a={startLevel:-1,safari:!0,debug:new PanoptoViewer.HlsjsDebugLogger(this.initParams.DeliveryId)};this.startTime&&(a.startPosition=this.startTime);var s={};try{s=JSON.parse(Panopto.viewer.hlsJsConfig)}catch(e){n.warning("Error parsing HlsJsConfig setting, ignored.")}_.extend(a,s),this.flowplayer=flowplayer(this.player,{key:this.initParams.PlayerKey,swf:this.initParams.FlowplayerSwfPath,swfHls:this.initParams.FlowplayerHlsSwfPath,clip:e,splash:!0,ratio:!1,fullscreen:!1,native_fullscreen:!0,keyboard:!1,embed:!1,tooltip:!1,speeds:r.playbackSpeeds,hlsjs:a,chromecast:!Panopto.features.disableFeaturesRequiringExternalNetworkAccess,vrvideo:{touchcontrols:!1,polyfill:!0,mode:this.initParams.VRType===PanoptoViewer.MediaVRType.Full?"full":this.initParams.VRType===PanoptoViewer.MediaVRType.Half?"half":void 0,renderOnPause:!0},debug:i}),this.flowplayer.conf.nativesubtitles=!1,this.player.toggleClass("mobile",this.isMobile),$("#player").find(".fp-elapsed, .fp-duration, .fp-remaining").appendTo("#hoverButtonContainer .flowplayer-time-display"),$("#overlay").prependTo(".fp-ui"),$("#hoverButtonContainer").appendTo(".fp-ui"),$("#playbackSpeedMenu").appendTo(".fp-player"),this.player.find(".fp-timeline-tooltip").appendTo(".fp-player"),$("#playlistOverlay").appendTo(".fp-player"),$(".fp-waiting").empty().append($("#loadingSpinner")).insertAfter(".fp-ui")},r.prototype.initializeQuotaTracker=function(){var t=this;if(Panopto.features.quotasEnabled){var o=this.delivery.user.email||"null";this.quotaPlaybackTracker=new e.Controls.QuotaPlaybackTracker(PanoptoCore.CookieHelpers,$("body"),Panopto.GlobalResources,this.deliveryId,this.delivery.ownerId,Panopto.user.userId,this.inviteId?Panopto.Core.StringHelpers.format(Panopto.freeTrialSignUpUrl+Panopto.Core.Constants.SignUpUrlParams,this.inviteId,o):Panopto.freeTrialSignUpUrl),this.quotaPlaybackTracker.onToggle.add((function(e){e?t.pause():t.resume()})),this.quotaPlaybackTracker.initialize(this.delivery.ownerIsOverQuota)}},r.prototype.initializeQuotaTrackerFlowplayer=function(){var t=this;if(Panopto.features.quotasEnabled){var o=this.delivery.user.email||"null";this.quotaPlaybackTracker=new e.Controls.QuotaPlaybackTracker(PanoptoCore.CookieHelpers,$("body"),Panopto.GlobalResources,this.deliveryId,this.delivery.ownerId,Panopto.user.userId,this.inviteId?Panopto.Core.StringHelpers.format(Panopto.freeTrialSignUpUrl+Panopto.Core.Constants.SignUpUrlParams,this.inviteId,o):Panopto.freeTrialSignUpUrl),this.quotaPlaybackTracker.onToggle.add((function(e){e?t.flowplayer.pause():t.flowplayer.play()})),this.quotaPlaybackTracker.initialize(this.delivery.ownerIsOverQuota),this.flowplayer.on("finish",(function(){t.quotaPlaybackTracker.fadeInModalForAnonymous()}))}},r.prototype.generateCaptionStylesheet=function(){var e=document.head.appendChild(document.createElement("style")),t=$(window).height(),o=$(window).width(),i=t;(t>o||PanoptoCore.Browser.$_mobile)&&(i=Math.min(t,o)/r.portraitVideoAspectRatio);var n=i/r.defaultHeight,a=r.defaultCaptionScaling*n,s=Panopto.captionSettings.size*a;s=Math.min(Math.max(s,r.minCaptionFontSize),r.maxCaptionFontSize);var l=Panopto.captionSettings.backgroundColor;"transparent"!==l&&(l=new PanoptoCore.Color(l).setAlpha(Panopto.captionSettings.opacity).toRgba()),e.sheet.insertRule("#captionPlayer .caption-player-container > p,#player .fp-subtitle > *,#player .fp-captions > * {color: "+Panopto.captionSettings.color+";background: "+l+";text-shadow: "+Panopto.captionSettings.textShadow+";font-size: "+s+"px;}",0)},r.prototype.configureGlobalControls=function(){var t=this;if(Panopto.Core.UI.Handlers.button($("#appBackButton, #absoluteBackButton"),(function(){t.isIosApp?window.location.href="panopto://close-player":t.isReactNativeApp&&t.sendReactNativeMessage({action:"back"})})),$("#appBackButton").css("padding-top",this.isIos?"8px":"7px").toggle(this.hasBackButton),$("#embed").toggleClass("has-back-button",this.hasBackButton),Panopto.Core.UI.Handlers.button($("#playIconContainer"),(function(){return t.loadVideo()})),Panopto.useFreeTrialTerminology){var o=e.ImageHelpers.getImageUrl("Logo/PanoptoLogo.svg");$("#fullViewerButton").html('<img src="'.concat(o,'" onload="SVGInject(this)" />'))}Panopto.Core.UI.Handlers.button($("#fullViewerButton"),this.handleFullViewerButtonActivated),$("#fullViewerButton").toggle(!!this.showFullViewerLink&&!!this.initParams.ViewerLink),this.fullViewerLinkEnabled||$("#fullViewerButton").addClass("disabled").attr("title",Panopto.GlobalResources.Embed_Tooltip_FullViewerDisabled),Panopto.Core.UI.Handlers.button($("#downloadButton"),(function(){window.open(t.downloadUrl)})),this.downloadEnabled&&$("#downloadButton").removeAttr("style")},r.prototype.configureSplashScreen=function(){var e=this;if(this.enableMultistream&&this.player.toggleClass("is-splash",!0),!this.initParams.IsAudioOnly){var t=this.initParams.ThumbUrl,o=function(e){return $("#splashScreen").css("background-image","url(".concat(e,")"))};o(t),$(new Image).on("error",(function(){return o(e.defaultThumbnailUrl)})).prop("src",t)}if(Panopto.Core.UI.Handlers.button($("#splashPlayIconContainer"),(function(){return e.loadVideo()}),{pointerEvent:"mousedown touchend"}),$("#splashScreen").click((function(t){e.menuOpen?(e.playlistOverlay&&e.playlistOverlay.hide(),t.preventDefault(),t.stopPropagation()):e.loadVideo()})),this.showBrand){var i=this.initParams.LogoUrl;i&&-1!==i.indexOf("_branding")&&($("#logo").attr({src:i,alt:Panopto.GlobalResources.Admin_Branding_EmbedLogo_Label}),Panopto.viewer.viewerWatermarkPosition&&(this.watermark=new PanoptoViewer.WatermarkLogo(i,Panopto.viewer.viewerWatermarkPosition),$("#embed").append(this.watermark.getBrandElem())))}this.isReactNativeApp||($("#cobrand").toggleClass("no-link",!Panopto.features.linkPoweredByPanoptoInEmbed).show(),$("#cobrand a").click((function(e){return e.stopPropagation()})))},r.prototype.configureFullscreenControls=function(){var e=this;Panopto.Core.UI.Handlers.button($("#fullScreenButton"),(function(){e.toggleFullscreen()})),PanoptoCore.Helpers.fullscreenEnabled?($("#fullScreenButton").show(),$(document).on("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",(function(){var t=e.isFullscreen;$("#fullScreenIcon").toggle(!t),$("#fullScreenExitIcon").toggle(t)}))):PanoptoCore.Browser.$_iphone&&(this.flowplayer.on("fullscreen",(function(){return e.handleNativeFullscreenToggled(!0)})),this.flowplayer.on("fullscreen-exit",(function(){return e.handleNativeFullscreenToggled(!1)})))},Object.defineProperty(r.prototype,"isFullscreen",{get:function(){return Boolean(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)},enumerable:!1,configurable:!0}),r.prototype.toggleFullscreen=function(e){if(this.fullscreenEnabled&&e!==this.isFullscreen)if(e=void 0===e?!this.isFullscreen:e,PanoptoCore.Helpers.fullscreenEnabled){var t=_.find(["requestFullscreen","webkitRequestFullScreen","mozRequestFullScreen","msRequestFullscreen"],(function(e){return"function"==typeof document.documentElement[e]})),o=_.find(["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"],(function(e){return"function"==typeof document[e]}));e?document.body[t]():document[o]()}else PanoptoCore.Browser.$_iphone&&(this.iPhoneReturnFromFullscreenPlaying=!this.videoElement.paused,this.flowplayer.fullscreen())},r.prototype.handleNativeFullscreenToggled=function(e){var t=this;if(this.nativeFullscreen=e,this.player.find("video").toggleClass("native-fullscreen",e),e)this.captionsDisplayed&&this.videoElement.textTracks.length&&this.toggleNativeCaptions(!0);else{var o=!1;_.each(this.videoElement.textTracks,(function(e){"showing"===e.mode&&(o=!0),e.mode="disabled"})),this.toggleCaptions(o),this.iPhoneReturnFromFullscreenPlaying&&setTimeout((function(){return t.videoElement.play()}),0)}},r.prototype.updateBroadcast=function(e){var t,o,i=this;if(this.delivery=e,this.timelineController)this.timelineController.updateDelivery(e),null===(t=this.timelineSeekBar)||void 0===t||t.setProps({broadcastEnded:e.broadcastEnded}),null===(o=this.timelinePlaybackControls)||void 0===o||o.setProps({broadcastEnded:e.broadcastEnded});else if(this.flowplayer&&!e.broadcastEnded&&e.activePrimary){var n=this.ensureMobileCompatibleManifest(e.activePrimary.url);if(n!==this.videoUrl){this.videoUrl=n;var a=this.flowplayer.conf.clip;_.each(a.sources,(function(e){e.src=n})),this.flowplayer.load(a,(function(){i.loggerSeekHandler&&i.loggerSeekHandler()}))}}},r.prototype.checkForBlockingLTIQuiz=function(){var e=this,t=$("#ltiQuizBlock");Panopto.LTIQuizBlock(t,{deliveryId:this.delivery.id,sessionHasQuiz:this.quizzes.length>0,ltiBlockSetting:PanoptoViewer.LTIQuizBlockingMode[Panopto.viewer.blockLTISessionsWithQuiz],ltiQueryParam:this.isLTIContext,checkBlockSessionOnQuizReporting:Panopto.Core.ServiceInterface.Rest.Sessions.blockSessionOnQuizReporting,onPopupResolved:function(){t.hide(),e.checkBlockingLTIQuiz.resolve()},resources:Panopto.GlobalResources})},r.prototype.loadVideo=function(){var e=this;this.playlistId&&!this.playlistOverlay.visible()&&this.showCopyrightNoticeIfRequired(),this.enableMultistream&&this.player.toggleClass("is-splash",!1),this.checkCopyrightNoticeRequirement.done((function(){if(!e.invocationRequested){e.invocationRequested=!0;var t=0;PanoptoCore.withRetry((function(o,i,n){e.createInvocation((function(e){e?i(e):3==++t?n():o()}))})).then((function(t){var o;e.invocationId=t,e.deliveryRefreshTimer.setInvocationId(e.invocationId),e.flowplayer&&e.delivery.activePrimary?e.attachPlaybackLoggerToFlowplayer():e.timelineController&&(e.timelineController.updateInvocationContext(Panopto.user.userId,t,e.deliveryId),e.delivery.isEmbedViewable&&e.attachPlaybackLoggerToTimelineController()),null===(o=e.eventOverlay)||void 0===o||o.setProps({showSendLogs:!0})})).catch((function(){e.pause(),PanoptoReactComponents.Dialogs.PanoptoConfirmController.confirm({message:Panopto.GlobalResources.Viewer_Dialogs_SpanUpdateBlocked_Message,confirmMessage:Panopto.GlobalResources.Viewer_Dialogs_SpanUpdateBlocked_AcceptMessage,cancelMessage:Panopto.GlobalResources.Viewer_Dialogs_SpanUpdateBlocked_CancelMessage,brandColor:"#".concat(Panopto.branding.accentColor),onClose:function(e){e&&window.open(Panopto.viewer.analyticsIngestBlockedSupportPageUrl,"_blank")}})})),e.checkBlockingLTIQuiz.then((function(){if(e.timelineController){var t=0;t=e.isLiveBroadcast?1/0:e.startTime,e.timelineController.start(t),e.remoteEmbed&&Panopto.enableEmbedApi&&e.sendApiStateUpdate(PanoptoViewer.EmbedApiMessagesToParent.StateUpdate),e.player.addClass("is-ready"),$().add("#player").add("#eventOverlayGutter").on("mousemove",(function(){e.showControls(r.controlDisplayDuration)})).on("focusin",(function(){e.showControls(r.controlDisplayDuration)})).on("mouseleave",(function(){if(e.autoHideEnabled){var t=!e.autoHideRequested;e.showControls(!1,{slowFade:!0,ignorePlayState:t})}})),$("#overlay").addClass("fp-ui"),$("#hoverButtonContainer").addClass("fp-ui"),e.hideOverlay&&($(".touch-overlay").css("visibility","hidden"),$("#overlay").css("visibility","hidden"))}e.flowplayer&&e.flowplayer.load(),$("#splashScreen").hide(),$("#gradientTop, #gradientBottom").insertAfter($("#splashScreen")),PanoptoCore.Browser.$_iphone&&!e.enableMultistream&&$("#fullScreenButton").toggle(e.fullscreenEnabled),$("#playIconContainer").off("click keydown").attr("tabindex",null).fadeOut(500),e.showControls(r.playDisplayDuration)}))}}))},r.prototype.createInvocation=function(e){var t=this,o=Panopto.Core.InvocationType.None;o=this.isIosApp?this.isLiveBroadcast?Panopto.Core.InvocationType.MobileApplicationBroadcast:Panopto.Core.InvocationType.MobileApplication:this.isAndroidApp?this.isLiveBroadcast?Panopto.Core.InvocationType.AndroidApplicationBroadcast:Panopto.Core.InvocationType.AndroidApplication:this.isReactNativeApp?this.isLiveBroadcast?Panopto.Core.InvocationType.ReactNativeMobileBroadcast:Panopto.Core.InvocationType.ReactNativeMobile:this.isVideoPreview?this.isLiveBroadcast?Panopto.Core.InvocationType.VideoPreviewBroadcast:Panopto.Core.InvocationType.VideoPreview:this.isLiveBroadcast?Panopto.Core.InvocationType.EmbedBroadcast:Panopto.Core.InvocationType.EmbedViewer;var i={deliveryId:this.deliveryId,inviteId:this.inviteId,invocationType:o},n=!1;this.ltiCourseId&&(n=!0,i.invocationContextType=Panopto.Core.InvocationContextType.LTILaunch,i.invocationContextLiteral=this.ltiCourseId);var a="CreateInvocation".concat(n?"WithContext":"");PanoptoCore.TokenAuth.getStoredAuthToken().then((function(o){if(o){var n={url:"".concat(Panopto.appRoot,"/Services/Data.svc/").concat(a),method:"POST",data:JSON.stringify(i),dataType:"json",accessToken:o,contentType:"application/json; charset=UTF-8",loadingIndicator:"",sendCredentials:!1};PanoptoCore.Helpers.ApiHelpers.CallAPI(n).then((function(t){var o=t.data&&void 0!==typeof t.data.d?t.data.d:t.data;e(o)})).fail((function(o){403===o?location.replace(t.loginUrl):e()}))}else Panopto.Util.callWebMethod({methodName:a,serviceURL:"".concat(Panopto.appRoot,"/Services/Data.svc"),params:i,onSuccess:function(t){return e(t)},onFailure:function(o){403===o._statusCode?location.replace(t.loginUrl):e()},loadingIndicator:""})}))},r.prototype.attachPlaybackLoggerToTimelineController=function(){var e=this;Panopto.Core.Analytics.PlaybackLogger(this.timelineController.createPlayerInterfaceForPlaybackLogger(),this.invocationId,Panopto.Core.ServiceInterface.AnalyticsIngest.addStreamRequests,{onSpanUpdated:function(t){e.quotaPlaybackTracker&&e.quotaPlaybackTracker.update(t)},onSpanUpdateBlocked:function(){return PanoptoViewer.handleSpanUpdateBlocked(Panopto.GlobalResources,Panopto.branding.accentColor,e.viewerLogging,Panopto.viewer.enableAutomaticLogsUpload,Panopto.viewer.analyticsIngestBlockedSupportPageUrl,e.deliveryId,e.invocationId,(function(){var t;null===(t=e.timelineController)||void 0===t||t.pause()}))}}).start()},r.prototype.isFlowPlayerAtTheEnd=function(){return this.isPositionAtTheEnd(this.flowplayer.video.time,this.flowplayer.video.duration)},r.prototype.isPositionAtTheEnd=function(t,o){return t>=o-e.Viewer.Constants.EndPositionThreshold},r.prototype.attachPlaybackLoggerToFlowplayer=function(){var t=this,o={position:function(){var o=e.Viewer.Constants.NativePositionFallbackRegion,i=t.flowplayer.video.time||0;return i>o&&t.videoElement&&t.videoElement.currentTime<o&&(i=t.videoElement.currentTime),i},playSpeed:function(){return t.flowplayer.currentSpeed},streamId:function(){return t.delivery.activePrimary.id},onSeek:function(e){t.loggerSeekHandler=e},offSeek:function(){t.loggerSeekHandler=void 0},onSpeedChange:function(e){t.loggerSpeedChangeHandler=e},offSpeedChange:function(){t.loggerSpeedChangeHandler=void 0},onPlayStateChangeLog:function(e){t.loggerPlayStateChangeHandler=e},offPlayStateChangeLog:function(){t.loggerPlayStateChangeHandler=void 0}},i=Panopto.Core.Analytics.PlaybackLogger(o,this.invocationId,Panopto.Core.ServiceInterface.AnalyticsIngest.addStreamRequests,{onSpanUpdated:function(e){t.quotaPlaybackTracker&&t.quotaPlaybackTracker.update(e)}}),n=function(){i.start(),t.isLiveBroadcast&&t.flowplayer.one("progress",(function(){t.loggerSeekHandler&&t.loggerSeekHandler()}))};this.flowplayer.on("seek",(function(){t.loggerSeekHandler&&t.loggerSeekHandler()})),this.flowplayer.on("pause",(function(){var e=t.isFlowPlayerAtTheEnd()?Panopto.Core.ViewerPlayState.Stopped:Panopto.Core.ViewerPlayState.Paused;t.loggerPlayStateChangeHandler&&t.loggerPlayStateChangeHandler(Panopto.Core.ViewerPlayState.Playing,e)})),this.flowplayer.on("resume",(function(){t.flowplayer.video.time<t.flowplayer.video.duration&&t.loggerPlayStateChangeHandler&&t.loggerPlayStateChangeHandler(Panopto.Core.ViewerPlayState.Paused,Panopto.Core.ViewerPlayState.Playing)})),this.flowplayer.on("stop",(function(){t.loggerPlayStateChangeHandler&&t.loggerPlayStateChangeHandler(void 0,Panopto.Core.ViewerPlayState.Stopped)})),this.flowplayer.ready?n():this.flowplayer.one("ready",(function(){return n()}))},r.prototype.configureFlowplayerControls=function(){var e,t,o=this,i=this.player.find(".fp-timeline"),n=this.player.find(".fp-timeline-tooltip");this.player.add($("#embed #eventOverlayGutter")).on("mousemove",(function(i){void 0===e||i.pageX===e&&i.pageY===t||o.eventOverlayShown&&o.isLandscape||o.showControls(r.controlDisplayDuration),e=i.pageX,t=i.pageY})).on("focusin",(function(){return o.showControls(r.controlDisplayDuration)})).on("mouseleave",(function(){if(o.autoHideEnabled){var e=!o.autoHideRequested;o.showControls(!1,{slowFade:!0,ignorePlayState:e})}})),this.flowplayer.on("resume",(function(){return o.showControls(r.playDisplayDuration)})),this.player.find(".fp-player").on("touchmove touchend",(function(){return o.showControls(r.controlDisplayDuration)})),this.isMobile||i.hover((function(){o.menuOpen||n.show()}),(function(){n.hide()})),i.attr({tabindex:1,role:"slider","aria-valuemin":0,"aria-valuemax":Math.round(this.flowplayer.video.duration),"aria-valuenow":Math.round(this.flowplayer.video.time),"aria-label":Panopto.GlobalResources.Embed_Timeline}),this.flowplayer.on("progress",(function(){i.attr("aria-valuenow",Math.round(o.flowplayer.video.time))})),this.isVR&&this.configureVRControls()},r.prototype.configureVRControls=function(){var e,t,o=this;this.player.find(".fp-ui").mousedown((function(o){e=o.pageX,t=o.pageY})).click((function(i){!(i.which===Panopto.Core.MouseButton.Left&&e===i.pageX&&t===i.pageY)||o.isLiveBroadcast||o.isMobile||o.togglePlayState()})),this.player.find(".fp-timeline").click((function(e){return e.stopPropagation()}))},r.prototype.updateDividerVisibility=function(){(this.downloadEnabled||this.showFullViewerLink)&&(this.nonNativeCaptionsAvailable||this.vspSupported&&"no-seeking"!==this.seekAndVspBehavior||this.fullscreenEnabled)&&$("#divider").show()},r.prototype.configurePanoptoControls=function(){var e=this;this.player.find(".touch-overlay").on("touchend",(function(t){e.showControls(r.controlDisplayDuration),t.preventDefault(),t.stopPropagation()})),$("#overlay, #title, #gradientTop, #gradientBottom").on("click",(function(t){var o=t.target!==t.currentTarget;o||e.menuOpen||e.isLiveBroadcast&&e.flowplayer||e.isMobile||e.togglePlayState(),!o&&e.isMobile&&e.showControls(!1,{ignorePlayState:!0}),e.flowplayer&&t.stopPropagation()})).dblclick((function(t){t.target!==t.currentTarget||e.isMobile||e.toggleFullscreen()}));var t=this.player.find(".mobile-transport-controls .play, .bottom-transport-controls .play");Panopto.Core.UI.Handlers.button(t,(function(){return e.togglePlayState()}),{pointerEvent:"mousedown touchstart"});var o=function(){var o=Panopto.GlobalResources[e.player.is(".is-playing")?"Embed_Tooltip_Pause":"Embed_Tooltip_Play"];t.attr({title:o,"aria-label":o})};this.flowplayer&&this.flowplayer.on("pause resume stop",(function(){return o()})),this.flowplayer&&o(),Panopto.Core.UI.Handlers.button($("#player .mobile-transport-controls .skip-back").add($("#player .bottom-transport-controls .skip-back")),(function(t,o){var i=e.timelineController?e.timelineState.timelinePosition:e.flowplayer.video.time;e.requestSeek(Math.max(i-10,0)),o.stopPropagation()}),{pointerEvent:"mousedown touchstart"}),Panopto.Core.UI.Handlers.button($("#player .mobile-transport-controls .skip-forward").add($("#player .bottom-transport-controls .skip-forward")),(function(t,o){var i=e.getPosition(),n=e.getDuration();e.requestSeek(Math.min(i+10,n)),o.stopPropagation()}),{pointerEvent:"mousedown touchstart"}),this.configureVolumeControls(),Panopto.Core.UI.Handlers.button($("#captionsButton"),(function(){e.activateCaptionsToggle()})),$("#captionsButton").toggle(this.nonNativeCaptionsAvailable),Panopto.Core.UI.Handlers.button($("#audioDescriptionsButton"),(function(){e.activateAudioDescriptionsToggle()})),$("#audioDescriptionsButton").toggle(this.initParams.EnableAudioDescriptions&&!!this.initParams.AvailableAudioDescriptionLanguages.length),this.updateDividerVisibility(),_.each(r.menus,(function(t){Panopto.Core.UI.Handlers.button($(t.buttonSelector),(function(o,i){e.toggleMenu(t);var n=$(t.menuSelector).find("."+r.selectedClass);$(o).is(".on")&&n.length&&(e.focusMenuItem(n),n.toggleClass(r.clickedClass,"click"===i.type))}))})),document.addEventListener("click",(function(t){var o=t.composedPath();_.each(r.menus,(function(t){-1===o.indexOf($(t.menuSelector)[0])&&-1===o.indexOf($(t.buttonSelector)[0])&&e.toggleMenu(t,!1)}))}),{capture:!0}),this.player.click((function(t){e.playlistOverlay&&!$(t.target).closest("#playlistOverlay").length&&e.playlistOverlay.hide(),$(t.target).closest(".layout-container").length||$(t.target).closest("#playbackControls").length||$(t.target).closest("#mobilePlaybackControls").length||$(t.target).closest("#navigationControls").length||(t.preventDefault(),t.stopPropagation())})),"no-seeking"===this.seekAndVspBehavior?this.disableSeekAndVspControls():this.enableSeekAndVspControls(),this.configurePlaybackSpeedControls()},r.prototype.configureVolumeControls=function(){var e=this;this.configureMuteButton(),this.isMobile?r.flowplayerGlobal.support.volume&&this.toggleMuted(this.startMuted):this.configureVolumeSlider(),this.flowplayer&&this.flowplayer.on("volume",(function(){var t=100*e.flowplayer.volumeLevel;e.setVolumeCookie(t)}))},r.prototype.setVolumeCookie=function(e){this.startTourMutedQuery||PanoptoCore.CookieHelpers.setUserCookieField(Panopto.user.userKey,r.volumeCookieKey,e)},r.prototype.configureMuteButton=function(){var e=this;Panopto.Core.UI.Handlers.button($("#muteButton"),(function(){return e.toggleMuted()})),$("#muteButton").show();var t=function(){var t=Panopto.GlobalResources[e.flowplayer.muted?"Embed_Muted":"Embed_Unmuted"];$("#muteButton").attr("title",t)};this.flowplayer&&this.flowplayer.on("mute",(function(){return t()})),this.flowplayer&&t()},r.prototype.toggleMuted=function(e){this.flowplayer&&(e=void 0===e?!this.flowplayer.muted:!!e,this.isMobile&&!e?this.flowplayer.volume(r.maxVolume/100):this.flowplayer.mute(e)),this.timelineController&&(e=void 0===e?!this.timelineState.muted:!!e,this.timelineController.muted(e))},r.prototype.configureVolumeSlider=function(){var e=this;Panopto.Core.UI.Handlers.hoverOrDrag($("#volumeControls"),(function(t){e.player.toggleClass("volume-active",t)}));var t=$("#volumeSlider");t.slider({min:0,max:100,step:1,orientation:"horizontal",slide:function(e,t){return o(t.value,{updateSlider:!1})}}),t.find("a.ui-slider-handle").attr("tabindex",r.controlButtonTabindex),this.flowplayer&&this.flowplayer.on("volume",(function(){var t=100*e.flowplayer.volumeLevel;o(t,{updatePlayer:!1})}));var o=function(o,i){var n=void 0===i?{}:i,a=n.updateSlider,r=void 0===a||a,s=n.updatePlayer,l=void 0===s||s;r&&t.slider("value",o),l&&(e.flowplayer&&e.flowplayer.volume(o/100),e.timelineController&&e.timelineController.volume(o/100),0===o&&(e.flowplayer&&e.flowplayer.mute(!0),e.timelineController&&e.timelineController.muted(!0))),$("#volumeLevel").css("width",o+"%")},i=this.startMuted?0:this.initialVolume;o(i),Panopto.Core.UI.Accessibility.slider(t,(function(e){return Panopto.GlobalResources.ViewerPlus_ARIA_PercentValue.format(e)}),Panopto.GlobalResources.Embed_Volume)},r.prototype.configurePlaybackSpeedControls=function(){var e=this,t=_.template($("#playbackSpeedTemplate").html());_.each(r.playbackSpeeds,(function(o){var i=$(t({speed:o,displaySpeed:e.getDisplaySpeed(o)}));i.insertAfter($("#playbackSpeedTemplate")),1===o&&i.toggleClass(r.selectedClass),Panopto.Core.UI.Handlers.button(i,(function(t,o){e.requestSpeed($(t).data("speed")),e.toggleMenu(r.menus.playbackSpeed,!1),$("#playbackSpeedButton").focus().toggleClass(r.clickedClass,"click"===o.type)}))})),Panopto.Core.UI.Handlers.key($("#playbackSpeedMenu, #playbackSpeedButton"),(function(t,o){e.showControls(r.controlDisplayDuration);var n=_.contains([i.RightArrow,i.UpArrow],o.which);if($(t).is("#playbackSpeedMenu")){var a=$(document.activeElement)[n?"prev":"next"](".item");a.length&&e.focusMenuItem(a)}else e.requestSpeed(n)}),[i.UpArrow,i.DownArrow,i.LeftArrow,i.RightArrow],{preserveExisting:!0}),this.flowplayer&&this.flowplayer.on("speed",(function(){return e.displaySpeed(e.flowplayer.currentSpeed)})),this.initialPlaySpeed!==PanoptoViewer.PlaySpeed.Normal&&this.setSpeed(this.initialPlaySpeed)},r.prototype.configureKeyHandler=function(){var e=this;$(document).on("keydown",(function(t){if(!($(t.target).closest("#eventOverlay").length||(e.showControls(r.controlDisplayDuration),t.ctrlKey||t.metaKey||t.altKey))){var o=!1,n=t.which;switch(n){case i.Space:e.isLiveBroadcast||e.togglePlayState();break;case i.Home:case i.End:e.requestSeekTo(n===i.Home?0:10);break;case i.UpArrow:case i.DownArrow:case i.LeftArrow:case i.RightArrow:var a=_.contains([i.RightArrow,i.LeftArrow],n),s=_.contains([i.RightArrow,i.UpArrow],n);if(t.shiftKey&&a)e.requestSpeed(s);else if(!t.shiftKey){var l=$(t.target).hasClass("fp-timeline");if(a||l)e.requestSeek(s);else if(!a){var c=s?.1:-.1;e.flowplayer.volume(e.flowplayer.volumeLevel+c)}}break;case i.Zero:case i.One:case i.Two:case i.Three:case i.Four:case i.Five:case i.Six:case i.Seven:case i.Eight:case i.Nine:e.requestSeekTo(n-i.Zero);break;case i.Period:e.requestSeekTo();break;case i.M:e.flowplayer.mute();break;case i.F:e.toggleFullscreen();break;case i.C:e.nonNativeCaptionsAvailable&&e.activateCaptionsToggle();break;case i.A:e.initParams.AvailableAudioDescriptionLanguages.length&&e.activateAudioDescriptionsToggle();break;case i.Esc:e.menuOpen?(e.hideMenus(),e.playlistOverlay&&e.playlistOverlay.hide(),e.showControls(r.controlDisplayDuration)):e.autoHideEnabled?e.showControls(!1,{ignorePlayState:!0}):Panopto.Core.ElementHelpers.blurActiveElement();break;default:o=!0}o||t.preventDefault()}}))},r.prototype.configureOrientationListener=function(){var e=this,t="orientation"in window.screen&&"type"in window.screen.orientation&&"onchange"in window.screen.orientation,o=function(){e.isLandscape=PanoptoCore.Browser.$_mobile?t?0===window.screen.orientation.type.indexOf("landscape"):90===Math.abs(Number(window.orientation)):window.innerWidth>window.innerHeight,e.setLayoutOrientation(e.isLandscape),Panopto.useFreeTrialTerminology&&$("#proLoginBanner").toggle(!e.isLandscape&&!Panopto.user.userId),e.eventOverlay&&e.eventOverlay.setProps({isLandscape:e.isLandscape}),PanoptoCore.Browser.$_android&&PanoptoCore.Browser.$_chrome&&e.toggleFullscreen(e.isLandscape)};PanoptoCore.Browser.$_mobile?t?window.screen.orientation.addEventListener("change",o):window.addEventListener("orientationchange",o):window.addEventListener("resize",o),o()},r.prototype.setLayoutOrientation=function(e){$("#eventOverlay").addClass("no-animation"),$("#embed").toggleClass("landscape",e),this.player[0].offsetHeight,$("#eventOverlay").removeClass("no-animation"),this.eventOverlayShown&&this.handleEventOverlayModeChanged({isOverlay:e})},r.prototype.configureProgressListener=function(t){var o=this,i=0;this.flowplayer.on("progress",(function(n,a,r){if(r!==i){var s=e.Viewer.Logic.ContentLogic.getBlockingContent(o.quizzes,r);if(a.seeking||s||(s=e.Viewer.Logic.ContentLogic.getPausingContent(o.quizzes,i,r)),s&&!t)o.showQuiz(s);else if(s&&t&&!o.quizWarnHasShown){o.quizWarnHasShown=!0,o.flowplayer.pause();var l=o.delivery.user.email||null,c=$("#proViewerSignupPopup");Panopto.SignupPromptPopup(c,{onClose:function(){c.hide(),o.flowplayer.play()},position:r,signupUrl:Panopto.freeTrialSignUpUrl,email:l,token:o.inviteId,sendGoogleAnalytics:function(e,t){return Panopto.GoogleAnalytics.sendProEvent(e,t)},resources:Panopto.GlobalResources})}i=r}}))},r.prototype.showQuiz=function(e){var o=this;if(!this.quizPlayer){this.toggleEventOverlay(!1),this.nativeFullscreen&&(this.videoElement.webkitExitFullScreen(),this.nativeFullscreen=!1),this.player.toggleClass(r.quizLoadingClass,!0);var i=e.timeline[0];this.flowplayer.video.time!==i&&this.seek(i);var n=$.Deferred();this.flowplayer.seeking?this.flowplayer.one("seek",(function(){o.flowplayer.pause(n.resolve)})):this.flowplayer.pause(n.resolve),n.then((function(){o.quizPlayer=new t.QuizPlayer(e,{container:$("#quizContainer"),userId:Panopto.user.userId,invocationId:o.invocationId,sessionId:o.deliveryId}),o.quizPlayer.toggle(!1),o.quizPlayer.loadedCallback.add((function(){o.player.toggleClass(r.quizLoadingClass,!1),o.quizPlayer.toggle(!0)})),o.quizPlayer.render()}))}},r.prototype.getSeekPositionAfterQuiz=function(e){var t=e.timeline[0];return"flash"===this.flowplayer.engine.engineName?t=Math.ceil(t/r.flowplayerFlashSeekableIncrement)*r.flowplayerFlashSeekableIncrement+r.flowplayerFlashSeekableOffset:t+=r.quizSeekOffset,t},r.prototype.configureQuizResultsController=function(){var t=this;this.quizResultsController=new e.Viewer.QuizResultsController(this.quizzes,this.ltiOutcomeConfig),this.quizResultsController.onQuizCompleted((function(e){t.quizPlayer.remove(),t.quizPlayer=null,t.seek(t.getSeekPositionAfterQuiz(e),(function(){setTimeout((function(){return t.flowplayer.resume()}),0)}))})),this.quizResultsController.onQuizClosed((function(e){if(t.quizPlayer.remove(),t.quizPlayer=null,e.isSessionPlaybackBlocking){var o=e.timeline[0]-r.quizSeekOffset;o<0&&(o=0),t.seek(o)}else t.seek(t.getSeekPositionAfterQuiz(e),(function(){return t.flowplayer.resume()}))}))},r.prototype.togglePlayState=function(e){if(this.flowplayer)void 0===e&&(e=!this.flowplayer.playing),e!==this.flowplayer.playing&&(this.updatePlayControls(e),e?this.flowplayer.resume():this.flowplayer.pause());else if(this.timelineController){var t=this.timelineController.togglePlayState();this.updatePlayControls(t)}},r.prototype.updatePlayControls=function(e){this.player.toggleClass("is-playing",e),this.player.toggleClass("is-paused",!e),$("#playIcon").toggle(e),$("#pauseIcon").toggle(!e),$("#playIconContainer").finish().show().fadeOut(r.playIconPulseDuration)},r.prototype.isPlaying=function(){var e=!1;return this.timelineState?e=!this.timelineState.paused:this.flowplayer&&(e=this.flowplayer.playing),e},r.prototype.getPosition=function(){var e=0;return this.timelineState?e=this.timelineState.timelinePosition:this.flowplayer&&(e=this.flowplayer.video.time),e},r.prototype.getDuration=function(){return this.timelineState?this.timelineState.duration:this.flowplayer.video.duration},r.prototype.seek=function(e,t){this.timelineController?("boolean"==typeof e&&(e=this.timelineState.timelinePosition+this.timelineState.duration/10*(e?1:-1)),this.lastTimelinePositionRequested=e,this.timelineController.seek(e,t)):this.flowplayer.seek(e,t)},r.prototype.requestSeek=function(e,t){"boolean"==typeof e&&(e=this.getPosition()+this.getDuration()/10*(e?1:-1));var o=this.timelineSeekHelper.getValidPosition(e);void 0!==o?this.seek(o,t):null==t||t()},r.prototype.requestSeekTo=function(e){var t;if(void 0!==(t=void 0!==e?this.getDuration()/10*e:this.lastTimelinePositionRequested)){var o=this.timelineSeekHelper.getValidPosition(t);void 0!==o&&this.seek(o)}},r.prototype.setVolume=function(e){this.timelineController?this.timelineController.volume(e):this.flowplayer&&this.flowplayer.volume(e)},r.prototype.resume=function(){this.timelineController?this.timelineController.resume():this.flowplayer&&this.flowplayer.resume()},r.prototype.pause=function(){this.timelineController?this.timelineController.pause():this.flowplayer&&this.flowplayer.pause()},r.prototype.mute=function(e){this.timelineController?this.timelineController.muted(e):this.flowplayer&&this.flowplayer.mute(e)},r.prototype.stop=function(){this.flowplayer&&this.flowplayer.stop(),this.timelineController&&(this.timelineController.pause(),this.seek(0))},r.prototype.showControls=function(e,t){var o=this,i=void 0===t?{}:t,n=i.slowFade,a=void 0!==n&&n,r=i.ignorePlayState,s=void 0!==r&&r,l=!!e||_.isUndefined(e);if(!(this.menuOpen||this.flowplayer&&!this.flowplayer.playing&&!l&&!s||this.timelineController&&this.timelineState.paused&&!l&&!s)){var c=function(){o.hideOverlay||(o.player.toggleClass("is-mouseover",l),o.player.toggleClass("is-mouseout",!l)),o.flowplayer&&!o.flowplayer.splash&&$("#embed").toggleClass("overlay-controls",l),o.timelineController&&(o.timelineState.activePrimary&&$("#embed").toggleClass("overlay-controls",l),o.player.find("#overlay").css("z-index",l?11:1)),l||$(document.activeElement).blur()};!l&&a?(this.player.add($("#embed")).addClass("slow-fade"),c(),this.player[0].offsetHeight,this.player.add($("#embed")).removeClass("slow-fade")):c(),clearTimeout(this.controlsHideTimeoutId),this.autoHideEnabled&&"number"==typeof e&&(this.controlsHideTimeoutId=window.setTimeout((function(){return o.showControls(!1,{slowFade:!0})}),e))}},r.prototype.toggleMenu=function(e,t){t=void 0===t?!$(e.menuSelector).is(".shown"):!!t,$(e.menuSelector).toggleClass("shown",t),$(e.buttonSelector).toggleClass("on",t),this.menuOpen=t},r.prototype.hideMenus=function(){var e=this;_.each(r.menus,(function(t){return e.toggleMenu(t,!1)}))},r.prototype.focusMenuItem=function(e){e.parent().find(".item").attr("tabindex",-1),e.attr("tabindex",r.controlButtonTabindex),e.focus()},r.prototype.activateCaptionsToggle=function(){this.toggleCaptions(),PanoptoCore.CookieHelpers.setUserCookieField(Panopto.user.userKey,r.captionsCookieKey,this.captionsDisplayed),this.initParams.IsAudioOnly&&this.autoHideEnabled&&this.showControls(r.playDisplayDuration)},r.prototype.activateAudioDescriptionsToggle=function(){this.toggleAudioDescriptions(),this.initParams.IsAudioOnly&&this.autoHideEnabled&&this.showControls(r.playDisplayDuration)},r.prototype.loadSubtitleTrack=function(){"none"!==this.interactivity&&this.eventOverlay.setProps({selectedLanguage:this.selectedCaption});try{this.timelineController?this.getCaptions(this.deliveryId,this.inviteId,this.selectedCaption):this.flowplayer.loadSubtitles(Math.max(this.initParams.AvailableLanguages.indexOf(this.selectedCaption),0))}catch(e){}},r.prototype.loadAudioDescriptionTrack=function(){"none"!==this.interactivity&&this.eventOverlay.setProps({selectedAudioDescriptionLanguage:this.selectedAudioDescriptionLanguage}),this.timelineController&&this.getAudioDescriptions(this.deliveryId,this.inviteId,this.selectedAudioDescriptionLanguage)},r.prototype.toggleNativeCaptions=function(e){_.each(this.videoElement.textTracks,(function(e){e.mode="disabled"})),this.videoElement.textTracks.length>0&&(this.videoElement.textTracks[0].mode=e?"showing":"disabled")},r.prototype.toggleCaptions=function(t){this.captionsDisplayed=void 0===t?!this.captionsDisplayed:t,$("#captionsButton").toggleClass("on",this.captionsDisplayed).toggleClass("off",!this.captionsDisplayed).prop("title",this.captionsDisplayed?Panopto.GlobalResources.Embed_Tooltip_HideCaptions:Panopto.GlobalResources.Embed_Tooltip_ShowCaptions);var o=this.captionsDisplayed?e.ImageHelpers.getImageUrl("Viewer/closed-caption.svg"):e.ImageHelpers.getImageUrl("Viewer/closed-caption-outline.svg");this.timelineController?this.timelineController.captionVisible(this.captionsDisplayed):this.captionsDisplayed?(this.loadSubtitleTrack(),this.isLiveBroadcast&&!this.nonNativeCaptionsAvailable&&this.videoElement.textTracks.length&&this.toggleNativeCaptions(!0)):(this.flowplayer.disableSubtitles(),this.isLiveBroadcast&&!this.nonNativeCaptionsAvailable&&this.toggleNativeCaptions(!1)),$("#captionSvg").replaceWith('<img class="material-icons" id="captionSvg" src="'.concat(o,'" onload="SVGInject(this)" />'))},r.prototype.toggleAudioDescriptions=function(t){var o;this.audioDescriptionsActivated=null!=t?t:!this.audioDescriptionsActivated,PanoptoCore.CookieHelpers.setUserCookieField(Panopto.user.userKey,r.audioDescriptionsCookieKey,this.audioDescriptionsActivated),$("#audioDescriptionsButton").toggleClass("on",this.audioDescriptionsActivated).toggleClass("off",!this.audioDescriptionsActivated).prop("title",this.audioDescriptionsActivated?Panopto.GlobalResources.Embed_Tooltip_DisableAudioDescriptions:Panopto.GlobalResources.Embed_Tooltip_EnableAudioDescriptions);var i=this.audioDescriptionsActivated?e.ImageHelpers.getImageUrl("Viewer/audio-description.svg"):e.ImageHelpers.getImageUrl("Viewer/audio-description-disabled.svg");$("#audioDescriptionSvg").replaceWith('<img class="material-icons" id="audioDescriptionSvg" src="'.concat(i,'" onload="SVGInject(this)" />')),null===(o=this.timelineController)||void 0===o||o.setAudioDescriptionsEnabled(this.audioDescriptionsActivated)},r.prototype.setSpeed=function(e){var t=this;"boolean"==typeof e&&(e=this.convertSpeedFromBoolean(e)),this.flowplayer?(this.flowplayer.speed(e),this.flowplayer.one("speed",(function(){t.loggerSpeedChangeHandler&&t.loggerSpeedChangeHandler()}))):this.timelineController&&this.timelineController.playbackRate(e)},r.prototype.requestSpeed=function(e){"boolean"==typeof e&&(e=this.convertSpeedFromBoolean(e));var t=this.timelineSeekHelper.getValidPlaySpeed(e,this.getPosition());void 0!==t&&this.setSpeed(t)},r.prototype.convertSpeedFromBoolean=function(e){var t,o,i=_.indexOf(r.playbackSpeeds,(null===(t=this.flowplayer)||void 0===t?void 0:t.currentSpeed)||(null===(o=this.timelineState)||void 0===o?void 0:o.playbackRate)||1),n=i+(e?1:-1),a=n>=0&&n<r.playbackSpeeds.length;return r.playbackSpeeds[a?n:i]},r.prototype.displaySpeed=function(e){$("#playbackSpeedButton .selected-value").text(this.getDisplaySpeed(e)),$("#playbackSpeedMenu .".concat(r.selectedClass)).removeClass(r.selectedClass),$("#playbackSpeedMenu [data-speed='".concat(e,"']")).addClass(r.selectedClass)},r.prototype.getDisplaySpeed=function(e){var t=Number(e).toLocaleString(Panopto.lang);return Panopto.GlobalResources.Embed_PlaybackSpeedFormat.format(t)},r.prototype.showNextDelivery=function(){var e=this,t=$("#nextDelivery"),i={url:o.setQueryParameters(location.href,{id:this.delivery.nextDelivery.id,autoplay:!0}),title:this.delivery.nextDelivery.title,description:this.delivery.nextDelivery.description,duration:this.delivery.nextDelivery.duration,thumbUrl:this.delivery.nextDelivery.thumbUrl,folderName:this.delivery.folder.name};if(i.url){t.show(),$("#player, #pipPlayer, #gridPlayers, #captionPlayer, #eventOverlay").hide(),Panopto.Core.UI.Components.nextDelivery(t,i,Panopto.GlobalResources.NextDelivery_NextVideo,Panopto.GlobalResources.NextDelivery_PlayAgain,(function(){var o,i;$("#player, #pipPlayer, #gridPlayers, #captionPlayer, #eventOverlay").show(),t.hide(),null===(o=e.flowplayer)||void 0===o||o.play(),null===(i=e.timelineController)||void 0===i||i.resume()}));var n=($(window).height()-t.height())/2;t.css({"padding-top":n+"px","padding-bottom":n+"px"})}},r.prototype.handleError=function(){var e=this;switch(this.initParams.ErrorCode){case PanoptoViewer.Data.ErrorCode.SiteDisabled:this.showErrorMessage(Panopto.GlobalResources.Embed_SiteDisabled);break;case PanoptoViewer.Data.ErrorCode.LoginRequired:this.showCallToAction({link:{id:"loginLink",url:this.loginUrl,text:Panopto.GlobalResources.Embed_LoginMessage}});break;case PanoptoViewer.Data.ErrorCode.AccessRequired:this.showCallToAction({message:Panopto.GlobalResources.Embed_RequestAccess,link:{id:r.requestAccessLinkId,url:"#",text:Panopto.GlobalResources.Embed_RequestAccessLink}}),Panopto.Core.UI.Handlers.button($("#"+r.requestAccessLinkId),(function(){return e.requestAccess()}));break;case PanoptoViewer.Data.ErrorCode.NotInAvailabilityWindow:this.showCallToAction({message:Panopto.GlobalResources.Embed_NotInAvailabilityWindow,link:{id:"availabilityLink",url:this.sessionListUrl,target:"_blank",text:Panopto.GlobalResources.ViewerPlus_WatchSomethingElse}});break;case PanoptoViewer.Data.ErrorCode.NetworkAccessDenied:this.showCallToAction({message:Panopto.viewer.networkAccessDeniedMessage});break;case PanoptoViewer.Data.ErrorCode.PodcastRequired:this.showCallToAction({message:Panopto.GlobalResources.Embed_VideoNotReady}),$("#callToActionContainer .spinner").show();break;case PanoptoViewer.Data.ErrorCode.InvalidUrl:this.showErrorMessage(Panopto.GlobalResources.Embed_InvalidUrl);break;case PanoptoViewer.Data.ErrorCode.InvalidDelivery:this.showErrorMessage(Panopto.GlobalResources.Embed_InvalidDelivery);break;case PanoptoViewer.Data.ErrorCode.InvalidPlaylist:case PanoptoViewer.Data.ErrorCode.InvalidPlaylistUrl:this.showErrorMessage(Panopto.GlobalResources.Embed_InvalidPlaylist);break;case PanoptoViewer.Data.ErrorCode.InvalidPlaylistNoSessions:this.showErrorMessage(Panopto.GlobalResources.Embed_PlaylistHasNoViewableSessions);break;case PanoptoViewer.Data.ErrorCode.HasPendingMergeOrCopyJobs:this.showErrorMessage(Panopto.GlobalResources.Embed_HasPendingMergeOrCopyJobs);break;case PanoptoViewer.Data.ErrorCode.Archived:this.renderArchiveMessage();break;case PanoptoViewer.Data.ErrorCode.UnknownError:default:this.showErrorMessage(Panopto.GlobalResources.Embed_UnknownError)}},r.prototype.showErrorMessage=function(e){this.player.hide(),$("#errorMessageWrapper").show(),$("#errorMessage").text(e),$("#absoluteBackButton").toggle(this.hasBackButton)},r.prototype.showCallToAction=function(e){if($("#embed").addClass("is-call-to-action"),e.link){e.message=e.message||"{0}",e.link.target=e.link.target||"_self";var t=_.template($("#callToActionLinkTemplate").html())(e.link),o=String.format(e.message,t);$("#callToAction").html(o)}else $("#callToAction").text(e.message)},r.prototype.appendDiagnostics=function(e){$("#diagnostics").append(e).show()},r.prototype.requestAccess=function(){var e=this,t={deliveryId:this.deliveryId},o=function(){e.showCallToAction({message:Panopto.GlobalResources.Embed_RequestAccessFailure,link:{id:r.requestAccessLinkId,url:"#",text:Panopto.GlobalResources.Embed_RequestAccessFailureTryAgain}}),Panopto.Core.UI.Handlers.button($("#"+r.requestAccessLinkId),(function(){return e.requestAccess()}))};Panopto.Util.callWebMethod({methodName:"RequestAccess",serviceURL:"".concat(Panopto.appRoot,"/Services/Data.svc"),params:t,onSuccess:function(t){t?e.showCallToAction({message:Panopto.GlobalResources.Embed_RequestAccessSuccess}):o()},onFailure:function(){return o()},loadingIndicator:""})},r.prototype.requestRestoreFromArchive=function(e){var t=this,o=[{DeliveryID:e}];Panopto.Core.ServiceInterface.Rest.Sessions.batchRestoreFromArchive(o,(function(){return t.showCallToAction({message:Panopto.GlobalResources.ViewerPlus_InitiateRestoreFromArchiveSuccess})}),(function(){return t.showCallToAction({message:Panopto.GlobalResources.ViewerPlus_InitiateRestoreFromArchiveFailure,link:{id:r.restoreFromArchiveLinkId,url:"#",text:Panopto.GlobalResources.ViewerPlus_InitiateRestoreFromArchive}}),void Panopto.Core.UI.Handlers.button($("#"+r.restoreFromArchiveLinkId),(function(){return t.requestRestoreFromArchive(e)}))}),$.noop)},r.prototype.configurePlaylistOverlay=function(t){var i=this;$("#overlay").addClass("playlist-mode");var n=!this.playlistAdvance;this.playlistOverlay=new e.Core.UI.Components.PlaylistOverlay($("#playlistOverlay"),$("#playlistButton"),this.playlistId,this.playlistDeliveryId,e.Core.UI.Components.PlaylistOverlaySkin.Embedded,{includeEmbedViewableOnly:!0},n,t&&!this.initParams.ErrorCode,new e.Core.API.Rest.PlaylistWithSessionsService),this.playlistOverlay.onPlayItem((function(e){if(e===i.deliveryId)i.initParams.ErrorCode||(i.showCopyrightNoticeIfRequired(),i.flowplayer&&(i.flowplayer.splash?i.loadVideo():i.flowplayer.resume()),i.timelineController&&(i.player.hasClass("is-ready")?i.timelineController.resume():i.loadVideo()));else{var t=o.setQueryParameters(location.href,{pid:i.playlistId,id:e,advance:!0});location.replace(t)}}));var a=function(e){var t;i.menuOpen&&i.hideMenus(),i.eventOverlayShown&&i.toggleEventOverlay(!1),e?i.showControls(!1,{ignorePlayState:!0}):i.showControls(r.controlDisplayDuration),$("#embed").toggleClass("overlay-controls",!e),i.menuOpen=e,$("#appBackButton").toggle(!e&&i.hasBackButton);var o=!e&&i.showTitle;$("#title").toggle(o),$("#player").toggleClass("title-shown",o),!(null===(t=i.flowplayer)||void 0===t?void 0:t.splash)&&i.player.hasClass("is-ready")||($("#logoContainer").toggle(!e),$("#playIconContainer").toggle(!e&&!i.isMobile),$("#splashPlayIconContainer").toggle(!e&&i.isMobile))};this.playlistOverlay.onToggle((function(e){return a(e)})),a(n),$("#playlistOverlay").on("click touchend",(function(e){return e.stopPropagation()}))},r.prototype.ensureMobileCompatibleManifest=function(e){var t=/_hlsbc/i.test(e),o=new RegExp(Panopto.viewer.mobileBroadcastUserAgentRegex,"i").test(navigator.userAgent);return this.isLiveBroadcast&&t&&o&&(e=e.replace("master.m3u8","master2.m3u8")),e},r.prototype.updateScormProgress=function(){var t=this;setInterval((function(){t.flowplayer?t.scormControl.updateProgress(t.flowplayer.video.time):t.timelineController&&t.scormControl.updateProgress(t.timelineState.timelinePosition)}),e.Viewer.Constants.TimedSyncRate)},r.prototype.enableSeekAndVspControls=function(){var e,t,o,i;this.player.removeClass(r.seekDisabledClass),this.player.find(".fp-timeline").attr("tabindex",0),this.vspSupported&&($("#playbackSpeedButton").show(),null===(e=this.timelineSeekBar)||void 0===e||e.setProps({disabled:!1}),null===(t=this.timelinePlaybackControls)||void 0===t||t.setProps({seekDisabled:!1}),null===(o=this.timelineMobilePlaybackControls)||void 0===o||o.setProps({seekDisabled:!1}),null===(i=this.timelineNavigationControls)||void 0===i||i.setProps({vspDisabled:!1}))},r.prototype.disableSeekAndVspControls=function(){var e,t,o,i,n=this;if(this.player.addClass(r.seekDisabledClass),this.player.find(".fp-timeline").removeAttr("tabindex"),$("#playbackSpeedButton").hide(),null===(e=this.timelineSeekBar)||void 0===e||e.setProps({disabled:!0}),null===(t=this.timelinePlaybackControls)||void 0===t||t.setProps({seekDisabled:!0}),null===(o=this.timelineMobilePlaybackControls)||void 0===o||o.setProps({seekDisabled:!0}),null===(i=this.timelineNavigationControls)||void 0===i||i.setProps({vspDisabled:!0}),this.flowplayer&&PanoptoCore.Browser.$_iphone){var a=this.videoElement.currentTime;this.videoElement.addEventListener("timeupdate",(function(){n.videoElement.seeking||(a=n.videoElement.currentTime)})),this.videoElement.addEventListener("seeking",(function(){n.videoElement.currentTime!==a&&n.nativeFullscreen&&(n.videoElement.currentTime=a)})),this.videoElement.addEventListener("ended",(function(){a=0}))}},r.prototype.renderArchiveMessage=function(){var t=this,o=function(e){if(e.isRestorable)t.showCallToAction({message:Panopto.GlobalResources.Embed_Archived,link:{id:r.restoreFromArchiveLinkId,url:"#",text:Panopto.GlobalResources.ViewerPlus_InitiateRestoreFromArchive}}),Panopto.Core.UI.Handlers.button($("#"+r.restoreFromArchiveLinkId),(function(){return t.requestRestoreFromArchive(e.deliveryId)}));else if(e.archiveRestorationRequestTime){var o=moment(e.archiveRestorationRequestTime).locale(Panopto.lang).fromNow(),i=moment.max(moment(e.archiveRestorationEstimatedCompletionTime),moment()).locale(Panopto.lang).fromNow();t.showErrorMessage(Panopto.GlobalResources.Archived_RestoreInProgress.format(o,i))}else t.showErrorMessage(Panopto.GlobalResources.Embed_ArchivedRestoreUnavailable)},i=e.API.Rest.ServiceFactory.getArchiveService();this.deliveryId?i.getDeliveryArchiveStatus(this.deliveryId,o,(function(){return t.showErrorMessage(Panopto.GlobalResources.Embed_ArchivedRestoreUnavailable)})):this.inviteId&&i.getDeliveryArchiveStatusByInviteId(this.inviteId,o,(function(){return t.showErrorMessage(Panopto.GlobalResources.Embed_ArchivedRestoreUnavailable)}))},r.prototype.initializeAudioDescriptions=function(){this.initParams.AvailableAudioDescriptionLanguages=PanoptoViewer.AudioDescriptionPlayer.filterToSupportedLanguages(this.initParams.AvailableAudioDescriptionLanguages),this.audioDescriptionsActivated=this.initParams.EnableAudioDescriptions&&!!this.initParams.AvailableAudioDescriptionLanguages.length&&!0===PanoptoCore.CookieHelpers.getUserCookieField(Panopto.user.userKey,r.audioDescriptionsCookieKey),this.initParams.AvailableAudioDescriptionLanguages.length&&(this.selectedAudioDescriptionLanguage=this.userSettingService.getSetting(this._selectedAudioDescriptionSetting),-1===this.initParams.AvailableAudioDescriptionLanguages.indexOf(this.selectedAudioDescriptionLanguage)&&(this.selectedAudioDescriptionLanguage=this.initParams.AvailableAudioDescriptionLanguages[0])),this.audioDescriptionsActivated&&(this.autoPlayRequested=!1)},r.prototype.showCopyrightNoticeIfRequired=function(){"pending"!==this.checkCopyrightNoticeRequirement.state()||this.copyrightNotice.isShowingNotice()||(this.initParams.ShowCopyrightNotice?this.copyrightNotice.showNotice(this.checkCopyrightNoticeRequirement.resolve):this.checkCopyrightNoticeRequirement.resolve())},r.hlsMimeType="application/x-mpegurl",r.mp4MimeType="video/mp4",r.rtmpMimeType="video/flash",r.captionsCookieKey="embedCaptions",r.audioDescriptionsCookieKey="audioDescriptions",r.volumeCookieKey="defaultEmbedVolume",r.maxVolume=100,r.requestAccessLinkId="requestAccessLink",r.restoreFromArchiveLinkId="restoreFromArchiveLink",r.defaultHeight=405,r.hoverCaptionsMinHeight=175,r.controlDisplayDuration=3e3,r.playDisplayDuration=500,r.playIconPulseDuration=750,r.quizSeekOffset=.5,r.controlButtonTabindex=2,r.portraitVideoAspectRatio=16/9,r.defaultCaptionScaling=2/3,r.minCaptionFontSize=16,r.maxCaptionFontSize=36,r.menus={playbackSpeed:{buttonSelector:"#playbackSpeedButton",menuSelector:"#playbackSpeedMenu"}},r.playbackSpeeds=PanoptoCore.mapEnum(PanoptoViewer.PlaySpeed,(function(e,t){return t})),r.clickedClass=Panopto.Core.Constants.ClickedClass,r.selectedClass=Panopto.Core.Constants.SelectedClass,r.quizLoadingClass="quiz-loading",r.seekDisabledClass="no-seek",r.flowplayerGlobal=flowplayer,r.flowplayerFlashSeekableIncrement=3,r.flowplayerFlashSeekableOffset=.25,r}();t.EmbeddedViewer=r}(e.Embed||(e.Embed={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){var t=PanoptoCore.VoidCallback,o=function(){function e(e,o){this.quiz=e,this._loadedCallback=new t,this.visible=!0,this.container=o.container,this.url=String.format(this.quiz.url,o.userId,o.invocationId,o.sessionId)+"&embedded=true"}return Object.defineProperty(e.prototype,"loadedCallback",{get:function(){return this._loadedCallback},enumerable:!1,configurable:!0}),e.prototype.toggle=function(e){this.visible=e,this.iframe&&this.iframe.toggle(e)},e.prototype.render=function(){var t=this;this.iframe=$(e.template(this.quiz)).appendTo(this.container),this.iframe.toggle(this.visible),this.iframe.on("load",(function(){return t._loadedCallback.fire()})),this.iframe.prop("src",this.url)},e.prototype.remove=function(){this.iframe.remove()},e.template=_.template('<iframe class="quiz-player"></iframe>'),e}();e.QuizPlayer=o}(e.Embed||(e.Embed={}))}(PanoptoTS||(PanoptoTS={})),(Panopto=Panopto||{}).Core=Panopto.Core||{},Panopto.Viewer=Panopto.Viewer||{},Panopto.GlobalResources=Panopto.GlobalResources||{},function(e){!function(e){var t=function(){function e(){}return e.TimedSyncRate=30,e.ControlSyncRate=1e3,e.SecondarySyncThreshold=1,e.SecondarySynchronizingUpdateRateMillis=50,e.InitialSecondaryThreshold=5,e.SecondaryStreamOffset=1.5,e.MinSegmentGap=1,e.ContiguousSegmentThreshold=.2,e.EndPositionThreshold=.1,e.BroadcastEndedIncrement=5e3,e.QualityReportThreshold=2,e.BroadcastStreamRetryTimeout=5e3,e.LivePositionTolerance=1,e.BroadcastEndThreshold=1,e.MaxPositionInterpolation=500,e.BufferingTimeoutThreshold=1e3,e.BadSeekThreshold=.1,e.NativePositionFallbackRegion=1,e.CircularLogBufferSize=2048,e.SecondaryContentClass="secondary-content",e.SecondaryPlayerClass="secondaryPlayer",e.SlideDeckId="slideDeck",e.ScreenCaptureClass="screen-capture",e.ObjectVideoTabClass="object-video",e.UrlTabClass="url",e.TocIconClass="toc",e.YouTubeIconClass="youtube",e.SmartChapterIconClass="smart-chapter",e.SlideDeckTabClass="slide-deck",e.PrimaryTabHeaderClass="primary-header",e.SecondaryTabHeaderClass="secondary-header",e.RecentBroadcastThreshold=144e5,e.PlayKeyCode=32,e.RewindKeyCode=37,e.ForwardKeyCode=39,e.VolumeUpKeyCode=38,e.VolumeDownKeyCode=40,e.MuteKeyCode=77,e.VolumeIncrement=10,e.PositionIncrement=5,e.MinVolume=0,e.MaxVolume=100,e.InitialVolume=100,e.SilverlightVersion="4.0.50401.0",e.PlaySpeedSilverlightVersion="5.0",e.QuickRewindSeconds=10,e.QuickForwardSeconds=30,e.FullScreenControlInterval=3,e.EditJumpSeconds=5,e.TOCMaxLength=200,e.EditorTimelineEndOffsetSeconds=.01,e.DisplayTimePrecisionMultiplier=Math.pow(10,Panopto.Core.Constants.DisplayTimeMillisecondPrecision),e.UrlEventClosenessTolerance=.1,e.BoundaryCutTolerance=.1,e.StreamDeleteCutTolerance=.01,e.LeftPaneRatio=.35,e.LeftPaneMinWidth=460,e.RightPaneMinWidth=480,e.HeaderBuffer=60,e.MaxDesktopTitleCharacters=120,e.MaxMobileTitleCharacters=60,e.EventRegionMinHeight=300,e.PlayerMinHeight=50,e.LeftPlayerDefaultHeight=260,e.LiveNotesClass="live-notes",e.MaxInlineSecondaryTabs=3,e.CollapseSecondaryTabsWidth=1200,e.SliderDragThreshold=2,e.InputMargin=14,e.InputOptionsMargin=4,e.ScrollBarWidth=20,e.AudioOnlyMinimumWidth=2,e.ThumbnailScrollTimeout=5e3,e.EventScrollTimeout=5e3,e.FlyoutTimeout=2e3,e.MissingSeekedEventTimeout=5e3,e.BaseUrl=Panopto.uriScheme+"://"+Panopto.webServerFQDN+Panopto.appRoot,e.EditorUrl=e.BaseUrl+"/Pages/Viewer.aspx?id={0}&edit=true",e.SessionListUrl=e.BaseUrl+"/Pages/Sessions/List.aspx",e.SilverlightEditorUrlTemplate=e.BaseUrl+"/Pages/Editor/Default.aspx#{0}",e.SlideImageUrl=e.BaseUrl+"/Pages/Viewer/Image.aspx",e.ThumbUrl=e.BaseUrl+"/Pages/Viewer/Thumb.aspx",e.DummyPDFUrl=e.BaseUrl+"/Scripts/PluginDetect/empty.pdf",e.FlashPlayerUrl="https://get.adobe.com/flashplayer",e.SinglePageAppUrl=Panopto.uriScheme+"://"+Panopto.webServerFQDN+Panopto.relativeSinglePageAppUrl,e.QuizEditUrlTemplate=e.SinglePageAppUrl+"quiz-configure/{0}?sessionId={1}",e.YouTubeEditUrlTemplate=e.SinglePageAppUrl+"youtubeEmbed/configure/{0}",e.HlsLevelFileNames=["index.m3u8","index2.m3u8"],e.JoinChannelOptionValue="joinChannel",e.SearchExpandDuration=400,e.FadeInterval=150,e.PlaySpeedResourceString="ViewerPlus_Speeds_{0}",e.BitrateResourcePrefixString="ViewerPlus_Bitrates_",e.BitrateResourceString=e.BitrateResourcePrefixString+"{0}",e.SearchTypeResourceString="ViewerPlus_Search_{0}",e.BitrateCookie="defaultBitrate",e.MBRBitrateCookie="defaultBitrateMBR",e.VolumeCookie="defaultVolume",e.CaptionsCookie="defaultCaptions",e.CaptionPlacementCookie="defaultCaptionPlacement",e.CaptionSizeCookie="defaultCaptionSize",e.CaptionColorCookie="defaultCaptionColor",e.AudioDescriptionsCookie="defaultAudioDescriptions",e.BitrateLevels=[Panopto.GlobalResources[e.BitrateResourcePrefixString+"Low"],Panopto.GlobalResources[e.BitrateResourcePrefixString+"Medium"],Panopto.GlobalResources[e.BitrateResourcePrefixString+"Medium"],Panopto.GlobalResources[e.BitrateResourcePrefixString+"High"]],e.PluginDetectPDFReader="PDFReader",e.SortRelevanceValue="relevance",e.SortTimeValue="time",e.SearchSortOrders=[{value:e.SortRelevanceValue,name:Panopto.GlobalResources.ViewerPlus_SortByRelevance},{value:e.SortTimeValue,name:Panopto.GlobalResources.ViewerPlus_SortByTime}],e.SearchRateLimitMilliseconds=1e3,e.MP4MimeType="video/mp4",e.HLSMimeType="application/x-mpegurl",e.Hive="Hive",e.Kollective="Kollective",e.KollectiveLongPollUrlBase="/api/v1/longpoll?ts={0}&ktoken=",e.LTIPage="/Panopto/LTI/LTI.aspx",e.OutcomeFormat="resultScore={0}&lis_result_sourcedid={1}&oauth_consumer_key={2}&lis_outcome_service_url={3}&lti_message_type=panopto_outcome_pox_response&lti_version=LTI-1p0",e}();e.Constants=t,function(e){e[e.High=2]="High",e[e.Medium=1]="Medium",e[e.Auto=0]="Auto"}(e.MBRBitrate||(e.MBRBitrate={})),function(e){e[e.Primary=1]="Primary",e[e.Secondary=2]="Secondary",e[e.LiveNotes=3]="LiveNotes"}(e.ViewMode||(e.ViewMode={}));var o=function(){function e(){}return e.getValues=function(e){return Object.keys(e).map((function(t){return e[t]})).filter((function(e){return!isNaN(e)}))},e.getNames=function(e){return Object.keys(e).map((function(t){return e[t]})).filter((function(e){return isNaN(e)})).map((function(e){return e.toString()}))},e.getNameValuePairs=function(e){return Object.keys(e).map((function(t){return new PanoptoCore.Models.KeyValue(t,e[t])})).filter((function(e){return!isNaN(e.value)}))},e}();e.EnumHelpers=o,function(e){e.HttpHeaders={Date:"date",LastModified:"last-modified"}}(t=e.Constants||(e.Constants={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),Panopto.Core.ViewerPlayState=Panopto.Core.ViewerPlayState||{},Panopto.Viewer.PlayState=function(e){return e.Playing=Panopto.Core.ViewerPlayState.Playing,e.Paused=Panopto.Core.ViewerPlayState.Paused,e.Stopped=Panopto.Core.ViewerPlayState.Stopped,e.Buffering=Panopto.Core.ViewerPlayState.Buffering,e}(Panopto.Viewer.PlayState||{}),function(e){!function(e){var t=PanoptoCore.Logging.Logger,o=function(){function o(i,n){var a=this;this.quizzes=i,this.ltiConfig=n,this.completedCallback=new PanoptoCore.TypedCallback,this.closedCallback=new PanoptoCore.TypedCallback,this.results={},this.isUpdatingResults=!1,this.onQuizCompleted=function(e){a.completedCallback.add(e)},this.onQuizClosed=function(e){a.closedCallback.add(e)},this.completeQuiz=function(e,t,o){var i=_.find(a.quizzes,(function(t){return t.id===e}));i&&(i.isSessionPlaybackBlocking=!1,a.ltiConfig&&a.recordResult(e,t,o),a.completedCallback.fire(i))},this.reportQuizResults=function(e,t,o){_.find(a.quizzes,(function(t){return t.id===e}))&&a.ltiConfig&&a.recordResult(e,t,o)},this.closeQuiz=function(e){var t=_.find(a.quizzes,(function(t){return t.id===e}));a.closedCallback.fire(t)},this.recordResult=function(o,i,n){if(_.isNumber(i)&&_.isNumber(n)){a.results[o]={correct:i,questions:n};var r=_.values(a.results);if(!_.contains(r,null)){var s=_.reduce(r,(function(e,t){return{correct:e.correct+t.correct,questions:e.questions+t.questions}})),l=Panopto.Core.StringHelpers.format(e.Constants.OutcomeFormat,s.correct/s.questions,a.ltiConfig.outcomeId,a.ltiConfig.oauthConsumerKey,a.ltiConfig.outcomeServiceUrl);a.isUpdatingResults=!0;var c=a.addAuthorizationHeader;PanoptoCore.TokenAuth.getStoredAuthToken().then((function(o){$.ajax({type:"GET",url:e.Constants.LTIPage,data:l,beforeSend:function(e){return c(e,o)},error:function(e){t.warning("Exception while performing an LTI page get in recordResult",e)}}).always((function(){a.isUpdatingResults=!1}))}))}}},o.instance=this,_.each(i,(function(e){a.results[e.id]=null})),$(window).on("beforeunload.quizResultsCheck",(function(){return a.isUpdatingResults||void 0}))}return o.getInstance=function(){return o.instance},o.prototype.addAuthorizationHeader=function(e,t){t&&e.setRequestHeader("Authorization","Bearer "+t)},o}();e.QuizResultsController=o}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(t){var o=PanoptoCore.VoidCallback,i=function(){function t(e,t,i){this.blocked=e,this.signupUrl=t,this.resources=i,this._onDismiss=new o}return Object.defineProperty(t.prototype,"onDismiss",{get:function(){return this._onDismiss},enumerable:!1,configurable:!0}),t.prototype.render=function(){var o=this;this.dialogTitle=this.blocked?this.resources.QuotaDialog_OutOfHours:this.resources.QuotaDialog_TryPanopto,this.dialogSubTitle=this.blocked?"<div class='quota-dialog-subtitle-spacing'>".concat(this.resources.QuotaDialog_GetAccess,"</div>"):"",this.panoptoLogo=e.ImageHelpers.getImageUrl("Header/Panopto_Logo_2015.svg"),this.element=$(t.template(this)),this.blocked||Panopto.Core.UI.Handlers.button(this.element.find(".quota-dialog-close"),(function(){o._onDismiss.fire()}))},t.prototype.getElement=function(){return this.element},t.template=_.template("\n            <div class='quota-anonymous-dialog quota-dialog'>\n                <@ if (!blocked) { @>\n                    <div class='quota-dialog-close'>\n                        <div class='material-icons'>close</div>\n                    </div>\n                <@ } @>\n                <div class='quota-dialog-header'><img src='<@- panoptoLogo @>' /></div>\n                <div class='quota-dialog-title'>\n                    <hr />\n                    <div class='quota-dialog-title-text'>\n                        <@= dialogTitle @>\n                        <div class='quota-dialog-subtitle'><@= dialogSubTitle @></div>\n                    </div>\n                    <hr />\n                </div>\n                <div class='quota-dialog-feature-container'>\n                    <div class='quota-dialog-feature'>\n                        <div class='material-icons'>videocam</div>\n                        <div class='quota-dialog-feature-text'><@- resources.QuotaDialog_Record @></div>\n                    </div>\n                    <div class='quota-dialog-feature'>\n                        <div class='material-icons'>create</div>\n                        <div class='quota-dialog-feature-text'><@- resources.QuotaDialog_Edit @></div>\n                    </div>\n                    <div class='quota-dialog-feature'>\n                        <div class='material-icons'>share</div>\n                        <div class='quota-dialog-feature-text'><@- resources.QuotaDialog_Share @></div>\n                    </div>\n                    <div class='quota-dialog-feature'>\n                        <div class='material-icons'>search</div>\n                        <div class='quota-dialog-feature-text'><@- resources.QuotaDialog_Search @></div>\n                    </div>\n                    <div class='quota-dialog-feature'>\n                        <div class='material-icons'>lock</div>\n                        <div class='quota-dialog-feature-text'><@- resources.QuotaDialog_Privacy @></div>\n                    </div>\n                </div>\n                <div class='quota-dialog-buttons'>\n                    <a\n                        href='<@- signupUrl @>'\n                        target='<@- blocked ? \"_self\" : \"_blank\" @>'\n                        class='quota-dialog-button'\n                        onclick='Panopto.GoogleAnalytics.sendProSignupEvent(\"viewers-popup-click\");'\n                    >\n                        <@- resources.QuotaDialog_SignUp @>\n                    </a>\n                </div>\n                <div class='quota-dialog-bottom-padding'></div>\n            </div>\n        "),t}();t.AnonymousUserDialog=i}(t.QuotaPlaybackModalDialogs||(t.QuotaPlaybackModalDialogs={}))}(e.Controls||(e.Controls={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(t){var o=function(){function t(e){this.resources=e}return t.prototype.render=function(){this.panoptoLogo=e.ImageHelpers.getImageUrl("Header/Panopto_Logo_2015.svg"),this.element=$(t.template(this)),Panopto.Core.UI.Handlers.button(this.element.find(".upgrade-link-dialog"),(function(){Panopto.GoogleAnalytics.sendProUpgradeEvent(PanoptoCore.ProUpgradeActions.Open,PanoptoCore.ProUpgradeLabels.OpenFromOwner),Panopto.ProUpgradePopup()}))},t.prototype.getElement=function(){return this.element},t.template=_.template("\n            <div class='quota-owner-dialog quota-dialog'>\n                <div class='quota-dialog-header'><img src='<@- panoptoLogo @>' /></div>\n                <div class='quota-dialog-title'>\n                    <hr />\n                    <div class='quota-dialog-title-text'><@- resources.QuotaDialog_Title_Owner @></div>\n                    <hr />\n                </div>\n                <div class='quota-dialog-feature-container'>\n                    <@- resources.QuotaDialog_Instructions_Owner @>\n                </div>\n                <div class='quota-dialog-buttons upgrade-link-dialog'>\n                    <a class='quota-dialog-button'>\n                        <@- resources.QuotaDialog_Upgrade @>\n                    </a>\n                </div>\n                <div class='quota-dialog-bottom-padding'></div>\n            </div>\n        "),t}();t.OwnerDialog=o}(t.QuotaPlaybackModalDialogs||(t.QuotaPlaybackModalDialogs={}))}(e.Controls||(e.Controls={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(t){var o=function(){function t(e){this.resources=e}return t.prototype.render=function(){this.panoptoLogo=e.ImageHelpers.getImageUrl("Header/Panopto_Logo_2015.svg"),this.element=$(t.template(this))},t.prototype.getElement=function(){return this.element},t.template=_.template("\n            <div class='quota-viewer-dialog quota-dialog'>\n                <div class='quota-dialog-header'><img src='<@- panoptoLogo @>' /></div>\n                <div class='quota-dialog-title'>\n                    <hr />\n                    <div class='quota-dialog-title-text'><@- resources.QuotaDialog_Title_Viewer @></div>\n                    <hr />\n                </div>\n                <div class='quota-dialog-feature-container'>\n                    <@- resources.QuotaDialog_Instructions_Viewer @>\n                </div>\n                <div class='quota-dialog-bottom-padding'></div>\n            </div>\n        "),t}();t.ViewerDialog=o}(t.QuotaPlaybackModalDialogs||(t.QuotaPlaybackModalDialogs={}))}(e.Controls||(e.Controls={}))}(PanoptoTS||(PanoptoTS={}));var Panopto,PanoptoTS;__spreadArray=this&&this.__spreadArray||function(e,t,o){if(o||2===arguments.length)for(var i,n=0,a=t.length;n<a;n++)!i&&n in t||(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))};Panopto.Viewer.Players=Panopto.Viewer.Players||{},function(e){!function(t){var o,i;o=t.Data||(t.Data={}),i=function(){function o(t,o,i){var n,a,r,s,l,c,u,d,p=Panopto.Viewer.Data,h=e.Viewer.Constants,m=t.Delivery.SessionName,g=Panopto.Core.TimeHelpers.formatWin32EpochTimeToDate(t.Delivery.SessionStartTime),y=t.Delivery.IsActiveBroadcast,v=t.Delivery.IsBroadcast&&t.Delivery.IsViewerEncodeComplete&&(new Date).getTime()-g.getTime()<=h.RecentBroadcastThreshold,f=_.chain(t.Delivery.Streams).filter((function(e){return"Archival"===e.StreamTypeName})).filter((function(e){var t=PanoptoViewer.isEditor()?e.EditMediaFileType:e.ViewerMediaFileType;return t===PanoptoViewer.MediaFileType.Ism||t===PanoptoViewer.MediaFileType.Wmv})).value().length>0,P=_.chain(t.Delivery.Streams).filter((function(e){if(!e.StreamUrl)return PanoptoCore.Logging.Logger.verbose("Delivery.ctor: Missing stream URL."),!1;var t=PanoptoViewer.isEditor()?e.EditMediaFileType:e.ViewerMediaFileType,o=!0;return t!==PanoptoViewer.MediaFileType.Ism&&t!==PanoptoViewer.MediaFileType.Wmv&&t!==PanoptoViewer.MediaFileType.Unknown&&null!=t||(PanoptoCore.Logging.Logger.verbose("Delivery.ctor: Legacy media type is not playable"+" (enum: ".concat(t,", str: ").concat(PanoptoViewer.MediaFileType[t],").")),o=!1),o})).value(),b=!1;if(P.length>0&&(t.Delivery.IsViewerEncodeAvailable||y)&&!o)PanoptoCore.Logging.Logger.info("Delivery.ctor: parsing and playing regular streams."),l=(n=this.parseStreams(P,m,y,null!=i&&i)).primaryStreams,c=n.secondaryStreams,u=n.activePrimary,d=n.screenCaptureStream;else if((null===(r=t.Delivery.PodcastStreams)||void 0===r?void 0:r.length)>0){PanoptoCore.Logging.Logger.info("Delivery.ctor: parsing and playing podcast stream."),b=!0,l=(a=this.parseStreams(t.Delivery.PodcastStreams,m,y,!1)).primaryStreams,c=a.secondaryStreams,u=a.activePrimary;var C=null===(s=_.find(t.Delivery.Streams,(function(e){return"Archival"===e.StreamTypeName})))||void 0===s?void 0:s.PublicID;l.forEach((function(e){return e.id=C}))}else l=[],c=[];var w=this.parseEvents(t.Delivery.Timestamps,t.Delivery.EventTargets,t.Delivery.PublicNotesStreams,t.Delivery.Duration,d),S=w.slides,k=w.documents,T=w.thumbnails,D=w.contents,A=w.channels;this.title=m,this.id=t.Delivery.PublicID,this.webcastVersionId=t.Delivery.WebcastVersionId,this.sourceDeliveryId=t.Delivery.SourceDeliveryId,this.date=g,this.duration=t.Delivery.Duration,this.description=t.Delivery.SessionAbstract,this.ownerId=t.Delivery.OwnerId,this.ownerFullName=t.Delivery.OwnerDisplayName,this.ownerBio=t.Delivery.OwnerBio,this.ownerIsOverQuota=t.Delivery.OwnerIsOverQuota,this.invocationId=t.InvocationId,this.embedUrl=t.EmbedUrl,this.downloadUrl=t.DownloadUrl,this.podcastCompleted=t.PodcastCompleted,this.broadcastRefreshInterval=1e3*t.BroadcastRefreshInterval,this.webcastApiRefreshInterval=1e3*t.WebcastPingIntervalInSeconds,this.broadcastSegmentBackoff=t.BroadcastSegmentBackoff,this.allowPublicNotes=t.AllowPublicNotes,this.hasAnyLinks=t.Delivery.HasAnyLinks,this.hasQuiz=t.Delivery.HasQuiz,this.firstQuizOffset=t.Delivery.FirstQuizOffset,this.hasCaptions=t.Delivery.HasCaptions,this.hasAudioDescriptions=t.Delivery.HasAudioDescriptions,this.availableLanguages=t.Delivery.AvailableLanguages,this.availableAudioDescriptionLanguages=t.Delivery.AvailableAudioDescriptionLanguages,this.isBroadcast=y,this.isViewable=y&&!!u||t.Delivery.IsViewerEncodeComplete&&t.Delivery.IsViewerEncodeAvailable,this.isEmbedViewable=this.isViewable||l.length>0,this.isReadyForEditing=t.Delivery.IsReadyForEditing,this.isReferenceCopy=t.Delivery.IsReferenceCopy,this.rehydrationAvailable=t.Delivery.RehydrationAvailable,this.isPurgedEncode=t.Delivery.IsPurgedEncode,this.isPurgedLegacyEncode=t.Delivery.IsPurgedLegacyEncode,this.requiresAdvancedEditor=t.Delivery.RequiresAdvancedEditor,this.broadcastEnded=t.Delivery.BroadcastEnded,this.broadcastInterrupted=t.Delivery.BroadcastInterrupted,this.isRecentBroadcast=v,this.isPrimaryAudioOnly=t.Delivery.IsPrimaryAudioOnly,this.requiresSilverlight=f,this.flowPlayerEnabled=Panopto.viewer.flowplayerEnabled&&!f,this.multiBitrateEnabled=(null==u?void 0:u.mediaFileType)===Panopto.Core.MediaFileType.hls,this.playSpeedEnabled=!0,this.audioDescriptionsEnabled=t.Delivery.AudioDescriptionsEnabled,this.discussionEnabled=t.Delivery.DiscussionEnabled,this.discussionCacheSeconds=t.DiscussionCacheSeconds,this.lastViewingPosition=t.LastViewingPosition,this.completionPercentage=t.CompletionPercentage,this.normalizeVolume=t.Delivery.NormalizeVolume,this.activePrimary=u,this.primaryStreams=l,this.secondaryStreams=c,this.slideDecks=!b&&S.length?[p.SlideDeck(S)]:[],this.documents=k,this.thumbnails=T,this.captions=[],this.audioDescriptions=[],this.contents=D,this.channels=A,this.tags=t.Delivery.Tags,this.user={email:t.UserEmail,name:t.UserName,key:(t.UserKey||"").toLowerCase(),rating:t.UserRating,role:t.SessionRole,canCreateQuestionLists:t.UserCanCreateQuestionLists,permissions:t.Delivery.Permissions||[]},this.folder={name:t.Delivery.SessionGroupLongName,description:t.Delivery.SessionGroupAbstract,id:t.Delivery.SessionGroupPublicID},this.nextDelivery=void 0,t.Delivery.NextDeliveryUrl&&(this.nextDelivery={id:t.Delivery.NextDeliveryId,url:t.Delivery.NextDeliveryUrl,title:t.Delivery.NextDeliveryTitle,description:t.Delivery.NextDeliveryDescription,duration:Panopto.Core.TimeHelpers.formatDuration(t.Delivery.NextDeliveryDuration,Panopto.GlobalResources.TimeSeparator),thumbUrl:t.Delivery.NextDeliveryThumbUrl,isLive:t.Delivery.NextDeliveryIsLive,folderName:void 0}),this.serverModel=t}return o.prototype.parseStreams=function(e,o,i,n){var a=_.map(_.filter(e,(function(e){return"Archival"===e.StreamTypeName})),(function(e){return Panopto.Viewer.Data.Stream(e,i,o)})),r=(a=_.sortBy(a,"relativeStart")).length?i?_.find(a,(function(e){return!e.relativeEnd}))||_.max(a,(function(e){return e.relativeEnd})):a[0]:void 0,s=i?a:r?[r]:[],l=_.map(_.filter(e,(function(e){return"Archival"!==e.StreamTypeName})),(function(e){return Panopto.Viewer.Data.Stream(e,i,o)})),c=_.find(l,(function(e){return e.tabClass===t.Constants.ScreenCaptureClass}));return n&&__spreadArray(__spreadArray([],s,!0),l,!0).forEach((function(e){/_hlsbc/i.test(e.url)&&(e.url=e.url.replace("master.m3u8","master2.m3u8"))})),{primaryStreams:s,secondaryStreams:l,activePrimary:r,screenCaptureStream:c}},o.prototype.parseEvents=function(t,o,i,n,a){var r=Panopto.Viewer.Data,s=_.filter(t,(function(e){return(e.Time||0===e.Time)&&e.Time<=n&&e.ObjectIdentifier&&e.ObjectSequenceNumber})),l=_.filter(s,(function(e){return"PowerPoint"===e.EventTargetType})),c=_.filter(s,(function(e){return e.Url})),u=[];_.each(c,(function(t){return u.push(new e.Viewer.Data.Document(t))})),_.each(o,(function(t){return u.push(new e.Viewer.Data.Document(t))}));var d=_.filter(s,(function(e){return!e.Url&&_.contains(["ObjectVideo","Primary","SmartOcrToc"],e.EventTargetType)})).concat(l);d.sort((function(e,t){return e.Time-t.Time}));var p,h=_.map(d,(function(t){return new e.Viewer.Data.Thumbnail(t,a)})).filter((function(e){return e.showInTableOfContents})),m=_.chain(d.concat(c)).unique().map((function(t){return new e.Viewer.Data.Event(t)})).filter((function(e){return!!jQuery.trim(e.text)&&e.showInTableOfContents})).value();return i&&(p=_.map(i,(function(e){return r.Channel(e,e,!0)}))),{slides:l,documents:u,thumbnails:h,contents:m,channels:p}},o}(),o.Delivery=i}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Data.Stream=function(e,t,o){var i,n=[],a=[],r=e.Name||("SCREEN"===e.Tag?Panopto.GlobalResources.ViewerPlus_ScreenCaptureTitle:Panopto.GlobalResources.ViewerPlus_ObjectVideoTitle),s="SCREEN"===e.Tag?PanoptoTS.Viewer.Constants.ScreenCaptureClass:PanoptoTS.Viewer.Constants.ObjectVideoTabClass,l=function(e,o){var i=e-PanoptoTS.Viewer.Constants.SecondaryStreamOffset;return t||o&&i<=o+PanoptoTS.Viewer.Constants.MinSegmentGap?e:Math.max(0,i)};switch(e.RelativeSegments&&e.RelativeSegments.length?_.each(e.RelativeSegments,(function(e,t){var o=new PanoptoTS.Viewer.Data.SecondarySegment(e),i=a[t-1];o.timelineStart=l(o.relativeStart,i?i.relativeEnd:0),a.push(o),n.push(o.timelineStart,o.relativeEnd)})):(n.push(l(e.RelativeStart,void 0)),e.RelativeEnd&&n.push(e.RelativeEnd)),(i=PanoptoTS.Viewer.Data.ContentHelpers.createBaseContent(r,e.PublicID,s,n,e.AbsoluteStart,"","",!1,!1,!1,t,!1)).url=e.StreamUrl,i.mediaFileType=PanoptoViewer.isEditor()?e.EditMediaFileType:e.ViewerMediaFileType,i.relativeStart=e.RelativeStart,i.relativeEnd=e.RelativeEnd,i.length=e.RelativeEnd?e.RelativeEnd-e.RelativeStart:0,i.segments=a,i.interrupted=e.Interrupted,i.deliveryTitle=o,i.broadcastSegmentDuration=e.BroadcastSegmentDuration,i.broadcastSegmentBackoff=e.BroadcastSegmentBackoff||Panopto.viewer.broadcastSegmentBackoff,i.vrType=e.VRType,Panopto.viewer.pureHlsJsPlayback&&i.vrType!==PanoptoViewer.MediaVRType.None&&PanoptoCore.Browser.isSafari&&(window.location.href=window.location.href+"&pureHlsJs=false"),e.Tag){case"AUDIO":i.type=Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Audio,i.isAudioOnly=!0;break;case"SCREEN":i.type=Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Screen,i.isAudioOnly=!1;break;default:i.type=Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Camera,i.isAudioOnly=!1}return i.optimizationToken=e.OptimizationToken,i},function(e){!function(e){!function(e){var t=function(e){this.relativeStart=e.RelativeStart,this.relativeEnd=e.End?e.RelativeStart+(e.End-e.Start):1/0,this.streamOffset=e.Start};e.SecondarySegment=t}(e.Data||(e.Data={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){var t=function(){function e(){}return e.prototype.getStreamFriendlyType=function(){var e;switch(this.type){case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Audio:e=Panopto.GlobalResources.ViewerPlus_AudioTitle;break;case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Screen:case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Slide:e=Panopto.GlobalResources.ViewerPlus_ScreenCaptureTitle;break;case Panopto.Core.ServiceInterface.Rest.Objects.StreamContentType.Camera:default:e=Panopto.GlobalResources.ViewerPlus_ObjectVideoTitle}return e},e.prototype.getStreamName=function(){return this.name||this.getStreamFriendlyType()},e.convertFromApiModel=function(t){var o=new e;return o.id=t.id,o.url=t.url,o.httpUrl=t.httpUrl,o.absoluteStart=t.absoluteStart,o.duration=t.duration,o.thumbnailUrlBase=t.thumbnailUrlBase,o.thumbnailInterval=t.thumbnailInterval,o.type=t.type,o.vrType=t.vrType,o.name=t.name,o.iconCode=t.iconCode,o.absoluteEnd=t.absoluteEnd(),o.streamType=t.isPrimary?1:2,o.normalizeVolume=t.normalizeVolume,o.mediaFileType=t.viewerMediaFileType,o},e}();e.Stream=t}(e.Data||(e.Data={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){var t=function(){function e(){}return e.getBlockingContent=function(e,t){return _.find(e,(function(e){var o=e.timeline[0];return e.isSessionPlaybackBlocking&&o<=t}))},e.getPausingContent=function(e,t,o){return _.find(e,(function(e){var i=e.timeline[0];return e.pauseWhenAvailable&&i>t&&i<=o}))},e}();e.ContentLogic=t}(e.Logic||(e.Logic={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Data.Channel=function(e,t,o){return{value:e,name:t||e,isUser:o}},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},function(e){!function(e){!function(e){var t=function(){function e(){}return e.createBaseContent=function(e,t,o,i,n,a,r,s,l,c,u,d){var p=(i=i||[])[0];return{title:e,id:t,tabClass:o,iconClass:a,iconCode:r,timeline:i,relativeStartTime:p,absoluteStartTime:n=n||p,hiddenTab:s,pauseWhenAvailable:l,isSessionPlaybackBlocking:c,isBroadcast:u,isSecondaryPaneOnly:d}},e}();e.ContentHelpers=t}(e.Data||(e.Data={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(t){var o=function(){function t(e){var t=e.Url||e.URL;if(t){t=window.location.protocol+"//"+t.replace(/^.*?:\/\//,"")}var o="number"!=typeof e.Time,i=this.constructBaseObject(e,t,o);_.extend(this,i),this.url=t,this.isPdf=o,this.isQuiz=e.IsQuestionList}return t.prototype.constructBaseObject=function(t,o,i){var n=t.Caption||(t.FileName?decodeURIComponent(t.FileName):Panopto.GlobalResources.ViewerPlus_Website),a=t.ID||t.PublicId||t.PublicID,r=[];i?r.push(0):(r.push(t.Time),r.push(t.Time+PanoptoViewer.Constants.UrlEventDuration));var s=-1!==o.indexOf(PanoptoViewer.Constants.YouTubeEmbedBaseUrl),l=i?Panopto.Core.Constants.DocumentIconCode:t.IsQuestionList?Panopto.Core.Constants.QuestionListIconCode:s?void 0:Panopto.Core.Constants.LinkIconCode,c=s?e.Viewer.Constants.YouTubeIconClass:void 0;return e.Viewer.Data.ContentHelpers.createBaseContent(n,a,i?"pdf":e.Viewer.Constants.UrlTabClass,r,void 0,c,l,t.IsQuestionList,!i,t.IsSessionPlaybackBlocking,!1,!0)},t}();t.Document=o}(t.Data||(t.Data={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(e){!function(e){var t=function(e){var t=e.EventTargetType||"UserCreatedTranscript",o=e.ID||e.EventID,i=o||e.PublicId!==Panopto.Core.Constants.EmptyGuid&&e.PublicId,n=i?"event"+i:"".concat(t,"-").concat(e.Time).replace(/\./gi,""),a=_.contains(["Transcript","UserCreatedTranscript"],t),r=_.contains(["ObjectVideo","Primary","PowerPoint","SmartOcrToc"],t),s=a?e.Data||e.Caption:r?e.Caption:e.Caption||e.Data,l=(e.UserName||"").toLowerCase(),c=t.replace(" ","");"Questions"===c&&(c="Comments"),this.id=n,this.eventId=o,this.eventPublicId=e.PublicId,this.sessionId=e.SessionID,this.time=e.Time,this.captionDuration=e.CaptionDuration,this.creationTime=e.CreationTime,this.text=s,this.user=l,this.userDisplayName=e.UserDisplayName||l,this.type=c,this.isQuestionList=e.IsQuestionList,this.saved=!0,this.createdDuringWebcast="Comments"===c&&e.CreatedDuringWebcast,this.url=e.Url,this.showInTableOfContents=e.ShowInTableOfContents};e.Event=t}(e.Data||(e.Data={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Data.Slide=function(e){return{time:e.Time,duration:e.Duration,absoluteTime:e.AbsoluteTime,queryParams:{id:e.ObjectIdentifier,number:e.ObjectSequenceNumber,x:void 0}}},(Panopto=Panopto||{}).Viewer=Panopto.Viewer||{},Panopto.Viewer.Data=Panopto.Viewer.Data||{},Panopto.Viewer.Data.SlideDeck=function(e){var t=_.map(e,Panopto.Viewer.Data.Slide),o=[];Panopto.features.serverAuthoritativeLeadingEvents||(t[0].time=0,o.push(t[0].time)),Panopto.features.serverAuthoritativeLeadingEvents&&t.forEach((function(e){o.push(e.time),o.push(e.time+e.duration)}));var i=PanoptoTS.Viewer.Data.ContentHelpers.createBaseContent(Panopto.GlobalResources.ViewerPlus_SlidesTitle,PanoptoTS.Viewer.Constants.SlideDeckId,PanoptoTS.Viewer.Constants.SlideDeckTabClass,o,t[0].absoluteTime,"","",!1,!1,!1,!1,!1);return i.slides=t,i},function(e){!function(e){!function(e){var t=function(){function e(){}return e.convertDeliveryToModel=function(e){return e.map((function(e){var t=new AutoClientModels.TagSearchItem;return t.content=e.Content,t.usageCount=e.UsageCount,t.id=e.PublicId,t}))},e}();e.TagHelper=t}(e.Data||(e.Data={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={})),function(e){!function(t){!function(t){var o=function(t,o){this.time=t.Time,this.text=t.Caption,this.queryParams={eventTargetPID:t.ObjectPublicIdentifier,sessionPID:t.SessionID,number:t.ObjectSequenceNumber,isPrimary:"Primary"===t.EventTargetType||"SmartOcrToc"===t.EventTargetType,absoluteTime:t.AbsoluteTime},this.isSlide="PowerPoint"===t.EventTargetType,this.showInTableOfContents=t.ShowInTableOfContents,t.ObjectStreamID!==Panopto.Core.Constants.EmptyGuid?this.tabId=t.ObjectStreamID:this.isSlide&&(this.tabId=o?o.id:e.Viewer.Constants.SlideDeckId)};t.Thumbnail=o}(t.Data||(t.Data={}))}(e.Viewer||(e.Viewer={}))}(PanoptoTS||(PanoptoTS={}));
//# sourceMappingURL=file://seasyn/jenkinsbuilds/rel_rtc_13.7.0/13.7.0.00014/_PublishedWebsites/WebUI/Scripts/Panopto/Bundles/Embed.js.map
